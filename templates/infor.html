<!DOCTYPE html>
<html lang="en">

<head>
  <title>Information Center - Bakery Management System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet" />
  <style>
    /* Custom animations for professional look */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    @keyframes slideInRight {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .animate-fade-in-up { animation: fadeInUp 0.6s ease-out; }
    .animate-slide-in-right { animation: slideInRight 0.8s ease-out; }
    .animate-pulse-custom { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    
    /* Custom gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Floating animation for cards */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .animate-float { animation: float 6s ease-in-out infinite; }
    
    /* Status indicator animations */
    .status-online { 
      background: linear-gradient(135deg, #10b981, #059669);
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
    }
    
    /* Custom scrollbar for FAQ */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
    
    /* Modal styles with glassy blur effect */
    .modal-overlay {
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      transition: all 0.3s ease;
    }
    
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        transform: translateY(-20px) scale(0.95);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 min-h-screen">
  {% extends "dashboard.html" %}
  {% block content %}
  
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-2xl shadow-xl p-8 text-center max-w-sm mx-4">
      <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-6"></div>
      <h3 class="text-xl font-bold text-gray-900 mb-2">Loading Information</h3>
      <p class="text-gray-600">Please wait...</p>
    </div>
  </div>

  <div class="w-full px-4 sm:px-6 lg:px-8 py-6 space-y-8">
    
    <!-- Header Section -->
    <div id="infoHeader" class="bg-white/70 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6 lg:p-8 animate-fade-in-up">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
        <div class="flex-1">
          <div class="flex items-center gap-4 mb-4">
            <div class="p-4 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl shadow-lg animate-float">
              <i data-lucide="info" class="w-8 h-8 text-white"></i>
            </div>
            <div>
              <h1 class="text-3xl lg:text-4xl font-black gradient-text">
                📋 Information Center
              </h1>
              <p class="text-lg font-semibold text-gray-700">Help, Support, and System Information</p>
            </div>
          </div>

          <!-- Quick Status Indicators -->
          <div id="systemStatus" class="flex flex-wrap gap-3">
            <div class="flex items-center gap-2 px-4 py-2 bg-emerald-50 border border-emerald-200 rounded-xl">
              <div class="w-2.5 h-2.5 bg-emerald-500 rounded-full status-online animate-pulse-custom"></div>
              <span class="text-sm font-semibold text-emerald-700">System Online</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-blue-50 border border-blue-200 rounded-xl">
              <i data-lucide="shield-check" class="w-4 h-4 text-blue-600"></i>
              <span class="text-sm font-semibold text-blue-700">Secure Connection</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 bg-purple-50 border border-purple-200 rounded-xl">
              <i data-lucide="clock" class="w-4 h-4 text-purple-600"></i>
              <span class="text-sm font-semibold text-purple-700" id="currentTime">Loading...</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div id="quickActions" class="flex flex-wrap gap-3">
          <button onclick="openSupportTicket()"
            class="inline-flex items-center px-5 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
            <i data-lucide="headphones" class="w-4 h-4 mr-2"></i>
            <span class="text-sm font-semibold">Get Support</span>
          </button>
          <button onclick="submitReview()"
            class="inline-flex items-center px-5 py-3 bg-gradient-to-r from-emerald-600 to-green-600 text-white rounded-xl hover:from-emerald-700 hover:to-green-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
            <i data-lucide="star" class="w-4 h-4 mr-2"></i>
            <span class="text-sm font-semibold">Submit Review</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Announcements Section -->
    <div id="announcementsSection" class="bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6 lg:p-8 animate-slide-in-right">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl lg:text-3xl font-black text-gray-900 flex items-center gap-3">
          <i data-lucide="megaphone" class="w-8 h-8 text-amber-500"></i>
          📢 Announcements
        </h2>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase bg-red-100 text-red-700 animate-pulse">
          <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
          New
        </span>
      </div>

      <div id="announcementsList" class="space-y-4">
        <!-- System Update Announcement -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-xl p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <i data-lucide="rocket" class="w-5 h-5 text-blue-600"></i>
                <h3 class="text-lg font-bold text-blue-900">System Update v2.1.5 Released</h3>
                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium">System</span>
              </div>
              <p class="text-blue-800 mb-3">New features include enhanced reporting, improved mobile responsiveness, and better data visualization tools.</p>
              <div class="flex items-center gap-4 text-sm text-blue-600">
                <span class="flex items-center gap-1">
                  <i data-lucide="calendar" class="w-4 h-4"></i>
                  December 15, 2024
                </span>
                <span class="flex items-center gap-1">
                  <i data-lucide="user" class="w-4 h-4"></i>
                  System Administrator
                </span>
              </div>
            </div>
            <button class="text-blue-600 hover:text-blue-700 p-2 hover:bg-blue-100 rounded-lg transition-colors">
              <i data-lucide="external-link" class="w-4 h-4"></i>
            </button>
          </div>
        </div>

        <!-- Maintenance Announcement -->
        <div class="bg-gradient-to-r from-amber-50 to-orange-50 border-l-4 border-amber-500 rounded-xl p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <i data-lucide="wrench" class="w-5 h-5 text-amber-600"></i>
                <h3 class="text-lg font-bold text-amber-900">Scheduled Maintenance Window</h3>
                <span class="text-xs bg-amber-100 text-amber-700 px-2 py-1 rounded-full font-medium">Maintenance</span>
              </div>
              <p class="text-amber-800 mb-3">System will be offline for maintenance on December 20th from 2:00 AM to 4:00 AM EST. Please save your work beforehand.</p>
              <div class="flex items-center gap-4 text-sm text-amber-600">
                <span class="flex items-center gap-1">
                  <i data-lucide="clock" class="w-4 h-4"></i>
                  Dec 20, 2:00 AM - 4:00 AM EST
                </span>
                <span class="flex items-center gap-1">
                  <i data-lucide="settings" class="w-4 h-4"></i>
                  2 hours duration
                </span>
              </div>
            </div>
            <button class="text-amber-600 hover:text-amber-700 p-2 hover:bg-amber-100 rounded-lg transition-colors">
              <i data-lucide="bell" class="w-4 h-4"></i>
            </button>
          </div>
        </div>

        <!-- Feature Announcement -->
        <div class="bg-gradient-to-r from-emerald-50 to-green-50 border-l-4 border-emerald-500 rounded-xl p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <i data-lucide="sparkles" class="w-5 h-5 text-emerald-600"></i>
                <h3 class="text-lg font-bold text-emerald-900">New AI Analytics Feature</h3>
                <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full font-medium">Feature</span>
              </div>
              <p class="text-emerald-800 mb-3">Introducing AI-powered insights and recommendations to help optimize your bakery operations and improve efficiency.</p>
              <div class="flex items-center gap-4 text-sm text-emerald-600">
                <span class="flex items-center gap-1">
                  <i data-lucide="brain" class="w-4 h-4"></i>
                  AI Powered
                </span>
                <span class="flex items-center gap-1">
                  <i data-lucide="trending-up" class="w-4 h-4"></i>
                  Boost Efficiency
                </span>
              </div>
            </div>
            <button class="text-emerald-600 hover:text-emerald-700 p-2 hover:bg-emerald-100 rounded-lg transition-colors">
              <i data-lucide="play-circle" class="w-4 h-4"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Announcement Detail Modal -->
    <div id="announcementModal" class="fixed inset-0 z-50 hidden">
      <!-- Modal Overlay -->
      <div class="fixed inset-0 bg-slate-900/20 backdrop-blur-md transition-all duration-300" id="modalOverlay"></div>
      
      <!-- Modal Container -->
      <div class="fixed inset-0 flex items-center justify-center p-4 sm:p-6 lg:p-8">
        <div id="modalContent" class="relative w-full max-w-2xl max-h-[90vh] overflow-hidden bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/30 transform transition-all duration-300 scale-95 opacity-0">
          
          <!-- Modal Header -->
          <div class="relative p-6 sm:p-8">
            <!-- Close Button -->
            <button 
              id="closeModalBtn" 
              class="absolute top-4 right-4 sm:top-6 sm:right-6 w-10 h-10 flex items-center justify-center bg-gray-100/80 hover:bg-gray-200/80 rounded-full transition-all duration-200 hover:scale-110 group"
              aria-label="Close modal"
            >
              <i data-lucide="x" class="w-5 h-5 text-gray-600 group-hover:text-gray-800"></i>
            </button>
            
            <!-- Modal Title Section -->
            <div class="pr-12">
              <div class="flex items-center gap-3 mb-4">
                <div id="modalIcon" class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg">
                  <i data-lucide="megaphone" class="w-6 h-6"></i>
                </div>
                <div class="flex-1">
                  <h2 id="modalTitle" class="text-2xl sm:text-3xl font-black text-gray-900 leading-tight">
                    Announcement Title
                  </h2>
                  <div class="flex items-center gap-2 mt-1">
                    <span id="modalType" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-700">
                      General
                    </span>
                    <span id="modalPriority" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">
                      Medium Priority
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Modal Body -->
          <div class="px-6 sm:px-8 pb-6 sm:pb-8">
            <!-- Content -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-3">Details</h3>
              <div id="modalContentText" class="prose prose-gray max-w-none">
                <p class="text-gray-700 leading-relaxed">
                  Announcement content will appear here...
                </p>
              </div>
            </div>
            
            <!-- Meta Information -->
            <div class="border-t border-gray-200/60 pt-6">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                <div class="flex items-center gap-2 text-gray-600">
                  <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
                  <span class="font-medium">Author:</span>
                  <span id="modalAuthor" class="text-gray-900">System Administrator</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                  <i data-lucide="calendar" class="w-4 h-4 text-gray-400"></i>
                  <span class="font-medium">Published:</span>
                  <span id="modalDate" class="text-gray-900">August 17, 2025</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                  <i data-lucide="clock" class="w-4 h-4 text-gray-400"></i>
                  <span class="font-medium">Time:</span>
                  <span id="modalTime" class="text-gray-900">10:30 AM</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                  <i data-lucide="tag" class="w-4 h-4 text-gray-400"></i>
                  <span class="font-medium">ID:</span>
                  <span id="modalId" class="text-gray-900 font-mono text-xs">#12345</span>
                </div>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200/60">
              <button 
                id="closeModalFooterBtn"
                class="px-6 py-2.5 text-gray-600 hover:text-gray-800 font-medium transition-colors duration-200"
              >
                Close
              </button>
              <button 
                id="shareAnnouncementBtn"
                class="px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105"
              >
                <i data-lucide="share-2" class="w-4 h-4 mr-2"></i>
                Share
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Support Ticketing System -->
      <div id="supportTicketingSection" class="lg:col-span-2 bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6 lg:p-8">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl lg:text-3xl font-black text-gray-900 flex items-center gap-3">
            <i data-lucide="headphones" class="w-8 h-8 text-blue-500"></i>
            🎧 Support Center
          </h2>
          <span class="text-sm text-gray-500">Response time: ~2 hours</span>
        </div>

        <!-- Support Stats -->
        <div id="supportStats" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
          <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 text-center">
            <div id="availability-stat" class="text-2xl font-black text-blue-800">24/7</div>
            <div class="text-sm text-blue-600 font-medium">Support Available</div>
          </div>
          <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-xl p-4 text-center">
            <div id="satisfaction-stat" class="text-2xl font-black text-emerald-800">98%</div>
            <div class="text-sm text-emerald-600 font-medium">Satisfaction Rate</div>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 text-center">
            <div id="response-stat" class="text-2xl font-black text-purple-800">&lt;2h</div>
            <div class="text-sm text-purple-600 font-medium">Avg Response</div>
          </div>
        </div>

        <!-- Support Ticket Form -->
        <div id="supportTicketForm" class="bg-gray-50 rounded-2xl p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Submit Support Ticket</h3>
          <form id="ticketForm" class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Priority Level</label>
                <select id="ticketPriority" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
                  <option value="low">🟢 Low - General Questions</option>
                  <option value="medium">🟡 Medium - System Issues</option>
                  <option value="high">🟠 High - Urgent Problems</option>
                  <option value="critical">🔴 Critical - System Down</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                <select id="ticketCategory" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
                  <!-- Categories will be loaded dynamically from database -->
                  <option value="">Loading categories...</option>
                </select>
              </div>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Subject</label>
              <input type="text" id="ticketSubject" placeholder="Brief description of your issue" 
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
              <textarea id="ticketDescription" rows="4" placeholder="Please provide detailed information about your issue or request"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none"></textarea>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 text-sm text-gray-600">
                <i data-lucide="shield-check" class="w-4 h-4"></i>
                <span>All communications are encrypted and secure</span>
              </div>
              <button type="submit" onclick="submitSupportTicket(event)"
                class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                <span class="font-semibold">Submit Ticket</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Recent Tickets -->
        <div id="recentTickets" class="mt-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">Your Recent Tickets</h3>
          <div id="recentTicketsList" class="space-y-3">
            <div class="flex items-center justify-center p-8 text-gray-500">
              <i data-lucide="loader" class="w-6 h-6 animate-spin mr-2"></i>
              Loading recent tickets...
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Links & Info Panel -->
      <div class="space-y-6">
        
        <!-- Submit Review Section -->
        <div id="reviewSection" class="bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i data-lucide="star" class="w-6 h-6 text-yellow-500"></i>
            ⭐ Submit Review
          </h3>
          
          <!-- Star Rating -->
          <div id="starRating" class="flex items-center gap-1 mb-4">
            <span class="text-sm font-medium text-gray-700 mr-3">Rate your experience:</span>
            <div class="flex gap-1">
              <button class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="1">★</button>
              <button class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="2">★</button>
              <button class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="3">★</button>
              <button class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="4">★</button>
              <button class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="5">★</button>
            </div>
          </div>
          
          <!-- Category Selection -->
          <div class="mb-4">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
            <select id="reviewCategory" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors">
              <option value="general">General Experience</option>
              <option value="system">System Performance</option>
              <option value="support">Customer Support</option>
              <option value="features">Features & Functionality</option>
              <option value="usability">Ease of Use</option>
            </select>
          </div>
          
          <textarea id="reviewText" placeholder="Share your feedback about the system... (optional)"
            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-colors resize-none mb-4" rows="3" maxlength="999"></textarea>
          
          <!-- Character Counter -->
          <div class="flex justify-between items-center mb-4">
            <span class="text-xs text-gray-500" id="charCounter">0/999 characters</span>
            <label class="flex items-center gap-2 text-sm text-gray-700">
              <input type="checkbox" id="isAnonymous" class="rounded border-gray-300 text-yellow-500 focus:ring-yellow-500">
              <span>Submit anonymously</span>
            </label>
          </div>
          
          <button id="submitReviewBtn" onclick="submitReviewForm()"
            class="w-full inline-flex items-center justify-center px-4 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-xl hover:from-yellow-600 hover:to-orange-600 transition-all duration-200 shadow-md hover:shadow-lg">
            <i data-lucide="send" class="w-4 h-4 mr-2"></i>
            <span class="font-semibold">Submit Review</span>
          </button>
        </div>

        <!-- System Information -->
        <div id="systemInfo" class="bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i data-lucide="monitor" class="w-6 h-6 text-blue-500"></i>
            🖥️ System Info
          </h3>
          
          <div class="space-y-3">
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">Version</span>
              <span class="text-sm font-semibold text-gray-900">v2.1.5</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">Status</span>
              <span class="text-sm font-semibold text-emerald-600 flex items-center gap-1">
                <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                Online
              </span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">Last Update</span>
              <span class="text-sm font-semibold text-gray-900">Dec 15, 2024</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">Uptime</span>
              <span class="text-sm font-semibold text-gray-900">99.9%</span>
            </div>
            <div class="flex justify-between items-center py-2">
              <span class="text-sm text-gray-600">Server Location</span>
              <span class="text-sm font-semibold text-gray-900">US East</span>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div id="quickLinks" class="bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <i data-lucide="external-link" class="w-6 h-6 text-purple-500"></i>
            🔗 Quick Links
          </h3>
          
          <div class="space-y-3">
            <a href="#" class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-blue-50 hover:text-blue-700 transition-all duration-200 group">
              <i data-lucide="book-open" class="w-5 h-5 text-gray-600 group-hover:text-blue-600"></i>
              <span class="font-medium">User Manual</span>
              <i data-lucide="arrow-right" class="w-4 h-4 ml-auto transform group-hover:translate-x-1 transition-transform"></i>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-green-50 hover:text-green-700 transition-all duration-200 group">
              <i data-lucide="video" class="w-5 h-5 text-gray-600 group-hover:text-green-600"></i>
              <span class="font-medium">Video Tutorials</span>
              <i data-lucide="arrow-right" class="w-4 h-4 ml-auto transform group-hover:translate-x-1 transition-transform"></i>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-purple-50 hover:text-purple-700 transition-all duration-200 group">
              <i data-lucide="code" class="w-5 h-5 text-gray-600 group-hover:text-purple-600"></i>
              <span class="font-medium">API Documentation</span>
              <i data-lucide="arrow-right" class="w-4 h-4 ml-auto transform group-hover:translate-x-1 transition-transform"></i>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-amber-50 hover:text-amber-700 transition-all duration-200 group">
              <i data-lucide="message-circle" class="w-5 h-5 text-gray-600 group-hover:text-amber-600"></i>
              <span class="font-medium">Community Forum</span>
              <i data-lucide="arrow-right" class="w-4 h-4 ml-auto transform group-hover:translate-x-1 transition-transform"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- FAQ Section -->
    <div id="faqSection" class="bg-white/80 backdrop-blur-md rounded-3xl shadow-xl border border-white/20 p-6 lg:p-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl lg:text-3xl font-black text-gray-900 flex items-center gap-3">
          <i data-lucide="help-circle" class="w-8 h-8 text-green-500"></i>
          ❓ Frequently Asked Questions
        </h2>
        <button onclick="searchFAQ()" class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2">
          <i data-lucide="search" class="w-4 h-4"></i>
          Search FAQ
        </button>
      </div>

      <!-- FAQ Search -->
      <div id="faqSearchContainer" class="mb-6 hidden">
        <div class="relative">
          <input type="text" id="faqSearchInput" placeholder="Search frequently asked questions..."
            class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
          <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
        </div>
      </div>

      <div id="faqList" class="space-y-4 max-h-96 overflow-y-auto custom-scrollbar">
        <!-- Loading state -->
        <div id="faqLoading" class="text-center py-8">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-gray-600">Loading FAQs...</p>
        </div>
        
        <!-- FAQ items will be loaded here dynamically -->
        <div id="faqItemsContainer" class="space-y-4 hidden">
          <!-- Dynamic FAQ items will be inserted here -->
        </div>
        
        <!-- No FAQs message -->
        <div id="noFaqsMessage" class="text-center py-8 hidden">
          <i data-lucide="help-circle" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
          <p class="text-gray-600">No FAQs found matching your search.</p>
        </div>
      </div>
    </div>

    <!-- Contact Information -->
    <div id="contactSection" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-3xl shadow-xl border border-blue-200 p-6 lg:p-8">
      <div class="text-center">
        <h2 class="text-2xl lg:text-3xl font-black text-blue-900 mb-4">
          📞 Need Additional Help?
        </h2>
        <p class="text-lg text-blue-700 mb-6">Our support team is here to assist you 24/7</p>
        
        <div id="contactGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Loading state -->
          <div id="contactLoading" class="col-span-full flex items-center justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
            <span class="text-gray-600">Loading contact information...</span>
          </div>
          
          <!-- Dynamic contact cards will be inserted here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Ticket Details Modal -->
  <div id="ticketModal" class="fixed inset-0 z-50 hidden modal-overlay flex items-center justify-center p-4">
    <div class="modal-content max-w-2xl w-full max-h-[90vh] overflow-y-auto rounded-2xl">
      <!-- Modal Header -->
      <div class="sticky top-0 bg-white/90 backdrop-blur-md border-b border-gray-200 px-6 py-4 flex items-center justify-between rounded-t-2xl">
        <div class="flex items-center gap-3">
          <div id="modalCategoryIcon" class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
            <i data-lucide="help-circle" class="w-4 h-4 text-blue-600"></i>
          </div>
          <div>
            <h3 id="modalTicketNumber" class="text-lg font-bold text-gray-900">Ticket #TK-2025-001</h3>
            <div class="flex items-center gap-2">
              <span id="modalTicketStatus" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">Open</span>
              <span id="modalTicketPriority" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">Medium</span>
            </div>
          </div>
        </div>
        <button id="closeTicketModalBtn" class="p-2 hover:bg-gray-100 rounded-lg transition-colors" onclick="closeTicketModal()">
          <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6 space-y-6">
        <!-- Subject -->
        <div>
          <label class="text-sm font-semibold text-gray-700 mb-2 block">Subject</label>
          <p id="modalSubject" class="text-lg font-medium text-gray-900 bg-gray-50 p-3 rounded-lg">Loading...</p>
        </div>

        <!-- Category -->
        <div>
          <label class="text-sm font-semibold text-gray-700 mb-2 block">Category</label>
          <div id="modalCategory" class="flex items-center gap-2 text-gray-700 bg-gray-50 p-3 rounded-lg">
            <i data-lucide="folder" class="w-4 h-4"></i>
            <span>Loading...</span>
          </div>
        </div>

        <!-- Description -->
        <div>
          <label class="text-sm font-semibold text-gray-700 mb-2 block">Description</label>
          <div id="modalDescription" class="prose prose-sm max-w-none bg-gray-50 p-4 rounded-lg border">
            <p class="text-gray-600">Loading ticket description...</p>
          </div>
        </div>

        <!-- Timestamps -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-semibold text-gray-700 mb-2 block">Created</label>
            <p id="modalCreatedDate" class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg flex items-center gap-2">
              <i data-lucide="calendar" class="w-4 h-4"></i>
              Loading...
            </p>
          </div>
          <div>
            <label class="text-sm font-semibold text-gray-700 mb-2 block">Last Updated</label>
            <p id="modalUpdatedDate" class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg flex items-center gap-2">
              <i data-lucide="clock" class="w-4 h-4"></i>
              Loading...
            </p>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200">
          <button id="closeTicketModalFooterBtn" class="px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors" onclick="closeTicketModal()">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Load contact information from API
    async function loadContactInformation() {
      try {
        const response = await fetch('/api/public/contact-information');
        const data = await response.json();
        
        if (data.success && data.contacts) {
          displayContactCards(data.contacts);
        } else {
          console.error('Failed to load contact information:', data.message);
          displayDefaultContacts();
        }
      } catch (error) {
        console.error('Error loading contact information:', error);
        displayDefaultContacts();
      }
    }

    // Display contact cards
    function displayContactCards(contacts) {
      const contactGrid = document.getElementById('contactGrid');
      const loadingElement = document.getElementById('contactLoading');
      
      // Hide loading state
      loadingElement.style.display = 'none';
      
      // Clear existing content
      contactGrid.innerHTML = '';
      
      // Color schemes for different contact types
      const colorSchemes = {
        phone: 'text-blue-600',
        email: 'text-green-600', 
        chat: 'text-purple-600'
      };
      
      contacts.forEach(contact => {
        const colorClass = colorSchemes[contact.contact_type] || 'text-gray-600';
        
        const contactCard = document.createElement('div');
        contactCard.className = 'bg-white rounded-2xl p-6 shadow-md hover:shadow-lg transition-shadow duration-200';
        
        contactCard.innerHTML = `
          <i data-lucide="${contact.icon}" class="w-8 h-8 ${colorClass} mx-auto mb-3"></i>
          <h3 class="font-bold text-gray-900 mb-2">${escapeHtml(contact.title)}</h3>
          ${contact.contact_type === 'chat' ? 
            `<button onclick="openLiveChat()" class="${colorClass} font-semibold hover:opacity-70 transition-opacity">${escapeHtml(contact.value)}</button>` :
            `<p class="${colorClass} font-semibold">${escapeHtml(contact.value)}</p>`
          }
          <p class="text-sm text-gray-600 mt-1">${escapeHtml(contact.availability || contact.response_time || 'Available')}</p>
          ${contact.description ? `<p class="text-xs text-gray-500 mt-2">${escapeHtml(contact.description)}</p>` : ''}
        `;
        
        contactGrid.appendChild(contactCard);
      });
      
      // Reinitialize Lucide icons for the new content
      lucide.createIcons();
    }

    // Display default contacts if API fails
    function displayDefaultContacts() {
      const contactGrid = document.getElementById('contactGrid');
      const loadingElement = document.getElementById('contactLoading');
      
      // Hide loading state
      loadingElement.style.display = 'none';
      
      // Clear existing content
      contactGrid.innerHTML = '';
      
      const defaultContacts = [
        {
          icon: 'phone',
          title: 'Phone Support',
          value: '1-800-BAKERY-1',
          availability: '24/7 Available',
          colorClass: 'text-blue-600'
        },
        {
          icon: 'mail',
          title: 'Email Support', 
          value: 'nyahgerald@gmail.com',
          availability: 'Response in minutes',
          colorClass: 'text-green-600'
        },
        {
          icon: 'message-circle',
          title: 'Live Chat',
          value: 'Start Chat',
          availability: 'Instant Response',
          colorClass: 'text-purple-600',
          isButton: true
        }
      ];
      
      defaultContacts.forEach(contact => {
        const contactCard = document.createElement('div');
        contactCard.className = 'bg-white rounded-2xl p-6 shadow-md';
        
        contactCard.innerHTML = `
          <i data-lucide="${contact.icon}" class="w-8 h-8 ${contact.colorClass} mx-auto mb-3"></i>
          <h3 class="font-bold text-gray-900 mb-2">${contact.title}</h3>
          ${contact.isButton ? 
            `<button onclick="openLiveChat()" class="${contact.colorClass} font-semibold hover:opacity-70">${contact.value}</button>` :
            `<p class="${contact.colorClass} font-semibold">${contact.value}</p>`
          }
          <p class="text-sm text-gray-600 mt-1">${contact.availability}</p>
        `;
        
        contactGrid.appendChild(contactCard);
      });
      
      // Reinitialize Lucide icons
      lucide.createIcons();
    }

    // Load contact information when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadContactInformation();
    });

    // Update current time
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      document.getElementById('currentTime').textContent = timeString;
    }

    // Star rating functionality
    let selectedRating = 0;
    document.querySelectorAll('.star-btn').forEach(star => {
      star.addEventListener('click', function() {
        selectedRating = parseInt(this.dataset.rating);
        updateStarDisplay();
      });
      
      star.addEventListener('mouseenter', function() {
        const rating = parseInt(this.dataset.rating);
        highlightStars(rating);
      });
    });

    document.getElementById('starRating').addEventListener('mouseleave', function() {
      updateStarDisplay();
    });

    function highlightStars(rating) {
      document.querySelectorAll('.star-btn').forEach((star, index) => {
        if (index < rating) {
          star.classList.add('text-yellow-400');
          star.classList.remove('text-gray-300');
        } else {
          star.classList.add('text-gray-300');
          star.classList.remove('text-yellow-400');
        }
      });
    }

    function updateStarDisplay() {
      highlightStars(selectedRating);
    }

    // FAQ functionality
    let allFaqData = []; // Store all FAQ data for search functionality
    
    // Load FAQ data from the database
    async function loadFAQData() {
      try {
        const response = await fetch('/api/public/faqs');
        const data = await response.json();
        
        if (data.success && data.faqs) {
          allFaqData = data.faqs;
          renderFAQItems(allFaqData);
        } else {
          console.warn('API returned no FAQs, using fallback data');
          loadFallbackFAQData();
        }
      } catch (error) {
        console.error('Error loading FAQ data:', error);
        console.log('Loading fallback FAQ data...');
        loadFallbackFAQData();
      } finally {
        hideFAQLoading();
      }
    }
    
    // Fallback FAQ data if database is not available
    function loadFallbackFAQData() {
      allFaqData = [
        {
          id: '1',
          question: 'How do I submit daily metrics?',
          answer: 'Go to the Form section from the main menu. Select the appropriate week and day, then fill in the metrics for both shifts. Make sure all required fields are completed before submitting.',
          category: 'forms',
          display_order: 1
        },
        {
          id: '2',
          question: 'How do I reset my password?',
          answer: 'To reset your password, go to the login page and click "Forgot Password". Enter your email address and follow the instructions sent to your email. The reset link is valid for 24 hours.',
          category: 'account',
          display_order: 2
        },
        {
          id: '3',
          question: 'What browsers are supported?',
          answer: 'The system supports the latest versions of Chrome, Firefox, Safari, and Edge. For the best experience, we recommend using Chrome or Firefox with JavaScript enabled.',
          category: 'technical',
          display_order: 3
        },
        {
          id: '4',
          question: 'Can I access the system on mobile devices?',
          answer: 'Yes! The system is fully responsive and optimized for mobile devices and tablets. You can access all features through your mobile browser without needing to install any app.',
          category: 'technical',
          display_order: 4
        },
        {
          id: '5',
          question: 'How do I export reports to Excel or PDF?',
          answer: 'Navigate to the Reports section and select the report you want to export. Click the "Export" button in the top-right corner and choose either PDF or Excel format. The file will be downloaded automatically.',
          category: 'reports',
          display_order: 5
        },
        {
          id: '6',
          question: 'How secure is my data?',
          answer: 'Your data is protected with enterprise-grade security including SSL encryption, secure databases, regular backups, and compliance with industry security standards. All access is logged and monitored.',
          category: 'security',
          display_order: 6
        }
      ];
      renderFAQItems(allFaqData);
    }
    
    // Render FAQ items in the DOM
    function renderFAQItems(faqs) {
      const container = document.getElementById('faqItemsContainer');
      const noFaqsMessage = document.getElementById('noFaqsMessage');
      
      if (!faqs || faqs.length === 0) {
        container.classList.add('hidden');
        noFaqsMessage.classList.remove('hidden');
        return;
      }
      
      // Clear existing content
      container.innerHTML = '';
      
      // Create FAQ items
      faqs.forEach(faq => {
        const faqItem = createFAQElement(faq);
        container.appendChild(faqItem);
      });
      
      // Show container and hide no FAQs message
      container.classList.remove('hidden');
      noFaqsMessage.classList.add('hidden');
    }
    
    // Create a single FAQ element
    function createFAQElement(faq) {
      const div = document.createElement('div');
      div.className = 'faq-item bg-white rounded-2xl border border-gray-200 overflow-hidden';
      
      div.innerHTML = `
        <button class="faq-question w-full px-6 py-4 text-left hover:bg-gray-50 transition-colors flex items-center justify-between"
          onclick="toggleFAQ(this)">
          <span class="font-semibold text-gray-900">${escapeHtml(faq.question)}</span>
          <i data-lucide="chevron-down" class="w-5 h-5 text-gray-500 transform transition-transform"></i>
        </button>
        <div class="faq-answer hidden px-6 pb-4">
          <p class="text-gray-700">${escapeHtml(faq.answer)}</p>
        </div>
      `;
      
      return div;
    }
    
    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, function(m) { return map[m]; });
    }
    
    // Hide FAQ loading indicator
    function hideFAQLoading() {
      const loadingElement = document.getElementById('faqLoading');
      if (loadingElement) {
        loadingElement.classList.add('hidden');
      }
    }
    
    // Show no FAQs message
    function showNoFAQsMessage() {
      const container = document.getElementById('faqItemsContainer');
      const noFaqsMessage = document.getElementById('noFaqsMessage');
      
      container.classList.add('hidden');
      noFaqsMessage.classList.remove('hidden');
    }
    
    function toggleFAQ(button) {
      const answer = button.nextElementSibling;
      const chevron = button.querySelector('i[data-lucide="chevron-down"]');
      
      if (answer.classList.contains('hidden')) {
        answer.classList.remove('hidden');
        chevron.style.transform = 'rotate(180deg)';
      } else {
        answer.classList.add('hidden');
        chevron.style.transform = 'rotate(0deg)';
      }
    }

    function searchFAQ() {
      const searchContainer = document.getElementById('faqSearchContainer');
      if (searchContainer.classList.contains('hidden')) {
        searchContainer.classList.remove('hidden');
        document.getElementById('faqSearchInput').focus();
      } else {
        searchContainer.classList.add('hidden');
        // Clear search when hiding
        document.getElementById('faqSearchInput').value = '';
        renderFAQItems(allFaqData);
      }
    }

    // Search FAQ functionality
    const faqSearchInput = document.getElementById('faqSearchInput');
    if (faqSearchInput) {
      faqSearchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (!searchTerm) {
          renderFAQItems(allFaqData);
          return;
        }
        
        const filteredFaqs = allFaqData.filter(faq => {
          const question = faq.question.toLowerCase();
          const answer = faq.answer.toLowerCase();
          return question.includes(searchTerm) || answer.includes(searchTerm);
        });
        
        renderFAQItems(filteredFaqs);
      });
    }

    // Support ticket submission
    function submitSupportTicket(event) {
      event.preventDefault();
      
      const priority = document.getElementById('ticketPriority').value;
      const category = document.getElementById('ticketCategory').value;
      const subject = document.getElementById('ticketSubject').value;
      const description = document.getElementById('ticketDescription').value;
      
      if (!subject.trim() || !description.trim()) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      if (!category) {
        showNotification('Please select a category', 'error');
        return;
      }
      
      // Show loading state
      const submitButton = event.target.querySelector('button[type="submit"]') || event.target;
      const originalText = submitButton.innerHTML;
      submitButton.innerHTML = '<i data-lucide="loader" class="w-4 h-4 mr-2 animate-spin"></i><span class="font-semibold">Submitting...</span>';
      submitButton.disabled = true;
      
      // Make API call to submit ticket
      fetch('/api/support/tickets', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          priority: priority,
          category_id: parseInt(category),
          subject: subject,
          description: description
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification(`Support ticket ${data.ticket_number} submitted successfully!`, 'success');
          document.getElementById('ticketForm').reset();
          loadRecentTickets(); // Refresh the recent tickets list
        } else {
          showNotification(data.error || 'Failed to submit ticket', 'error');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showNotification('Failed to submit ticket. Please try again.', 'error');
      })
      .finally(() => {
        // Restore button
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
        lucide.createIcons(); // Refresh icons
      });
    }

    // Review submission
    async function submitReviewForm() {
      const reviewText = document.getElementById('reviewText').value.trim();
      const category = document.getElementById('reviewCategory').value;
      const isAnonymous = document.getElementById('isAnonymous').checked;
      const submitBtn = document.getElementById('submitReviewBtn');
      
      // Comprehensive validation
      if (selectedRating === 0) {
        showNotification('Please select a star rating before submitting', 'error');
        highlightStarRating();
        return;
      }
      
      if (reviewText.length > 999) {
        showNotification('Review text must be less than 1000 characters', 'error');
        document.getElementById('reviewText').focus();
        return;
      }
      
      if (!category) {
        showNotification('Please select a review category', 'error');
        document.getElementById('reviewCategory').focus();
        return;
      }
      
      // Show loading state
      const originalBtnContent = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 mr-2 animate-spin"></i><span class="font-semibold">Submitting...</span>';
      submitBtn.disabled = true;
      
      try {
        // Enhanced debugging for browser vs test environment
        const requestPayload = {
          rating: selectedRating,
          review_text: reviewText || null,
          category: category,
          is_anonymous: isAnonymous
        };
        
        console.log('🚀 DEBUG: Review submission started');
        console.log('📊 DEBUG: Request payload:', requestPayload);
        console.log('⭐ DEBUG: Selected rating:', selectedRating, 'Type:', typeof selectedRating);
        console.log('📝 DEBUG: Review text:', reviewText, 'Length:', reviewText ? reviewText.length : 0);
        console.log('🏷️ DEBUG: Category:', category);
        console.log('👤 DEBUG: Is anonymous:', isAnonymous);
        
        const response = await fetch('/api/submit-review', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify(requestPayload)
        });
        
        console.log('📡 DEBUG: Response status:', response.status);
        console.log('📡 DEBUG: Response headers:', Object.fromEntries([...response.headers]));
        
        let data;
        try {
          const responseText = await response.text();
          console.log('📄 DEBUG: Raw response text:', responseText);
          data = JSON.parse(responseText);
          console.log('📄 DEBUG: Parsed response data:', data);
        } catch (parseError) {
          console.error('❌ DEBUG: Failed to parse JSON response:', parseError);
          showNotification('Server response was not valid JSON. Please try again.', 'error');
          return;
        }
        
        if (response.ok && data.success) {
          console.log('✅ DEBUG: Review submission successful');
          showNotification('Thank you for your feedback! Your review has been submitted.', 'success');
          
          // Reset form
          document.getElementById('reviewText').value = '';
          document.getElementById('reviewCategory').value = 'general';
          document.getElementById('isAnonymous').checked = false;
          selectedRating = 0;
          updateStarDisplay();
          updateCharCounter();
          
        } else {
          console.log('❌ DEBUG: Review submission failed');
          console.log('❌ DEBUG: Response status:', response.status);
          console.log('❌ DEBUG: Response data:', data);
          
          // Handle specific backend errors
          if (data && data.error) {
            if (data.error.includes('rating')) {
              showNotification('Invalid rating selected. Please choose between 1-5 stars.', 'error');
              highlightStarRating();
            } else if (data.error.includes('characters') || data.error.includes('length')) {
              showNotification('Review text is too long. Please keep it under 1000 characters.', 'error');
              document.getElementById('reviewText').focus();
            } else {
              showNotification(data.error, 'error');
            }
          } else if (data && data.message) {
            showNotification(data.message, 'error');
          } else {
            showNotification(`Failed to submit review. Server returned ${response.status}. Please try again.`, 'error');
          }
        }
        
      } catch (error) {
        console.error('💥 DEBUG: Exception caught in review submission:', error);
        console.error('💥 DEBUG: Error name:', error.name);
        console.error('💥 DEBUG: Error message:', error.message);
        console.error('💥 DEBUG: Full error:', error);
        
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          showNotification('Network error. Please check your internet connection and try again.', 'error');
        } else {
          showNotification(`An unexpected error occurred: ${error.message}. Please try again later.`, 'error');
        }
      } finally {
        // Restore button
        submitBtn.innerHTML = originalBtnContent;
        submitBtn.disabled = false;
        lucide.createIcons(); // Refresh icons
      }
    }

    // Quick action functions
    function openSupportTicket() {
      document.getElementById('supportTicketingSection').scrollIntoView({ behavior: 'smooth' });
      document.getElementById('ticketSubject').focus();
    }

    function submitReview() {
      document.getElementById('reviewSection').scrollIntoView({ behavior: 'smooth' });
      document.getElementById('reviewText').focus();
    }

    function openLiveChat() {
      showNotification('Opening live chat window...', 'info');
      // In a real implementation, this would open a chat widget
    }

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `fixed top-4 right-4 z-50 p-4 rounded-xl shadow-xl max-w-sm animate-fade-in-up`;

      const colors = {
        success: 'bg-emerald-600 text-white',
        error: 'bg-red-600 text-white',
        warning: 'bg-amber-500 text-white',
        info: 'bg-blue-600 text-white'
      };

      const icons = {
        success: 'check-circle',
        error: 'alert-circle',
        warning: 'alert-triangle',
        info: 'info'
      };

      notification.className += ` ${colors[type]}`;
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <i data-lucide="${icons[type]}" class="w-5 h-5"></i>
          <span class="text-sm font-medium">${message}</span>
        </div>
      `;

      document.body.appendChild(notification);
      lucide.createIcons();

      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Load support categories from database
    function loadSupportCategories() {
      console.log('Loading support categories...');
      
      fetch('/api/support/categories', {
        credentials: 'include'
      })
        .then(response => {
          console.log('Categories API response status:', response.status);
          console.log('Categories API response headers:', response.headers);
          return response.json();
        })
        .then(data => {
          console.log('Categories API data received:', data);
          
          const categorySelect = document.getElementById('ticketCategory');
          categorySelect.innerHTML = '<option value="">Select a category</option>';
          
          if (data.success && data.categories) {
            console.log(`Found ${data.categories.length} categories`);
            data.categories.forEach(category => {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = `${getCategoryIcon(category.name)} ${category.name}`;
              categorySelect.appendChild(option);
            });
            console.log('Categories loaded successfully');
          } else {
            console.log('Categories API returned error:', data);
            categorySelect.innerHTML = '<option value="">Failed to load categories</option>';
          }
        })
        .catch(error => {
          console.error('Error loading categories:', error);
          document.getElementById('ticketCategory').innerHTML = '<option value="">Failed to load categories</option>';
        });
    }

    // Helper function to get category icon
    function getCategoryIcon(categoryName) {
      const icons = {
        'Technical Support': '🔧',
        'Account Issues': '👤',
        'Billing Questions': '💳',
        'Feature Request': '✨',
        'Bug Report': '🐛',
        'Training Request': '📚'
      };
      return icons[categoryName] || '📋';
    }

    // Load support statistics from database
    function loadSupportStatistics() {
      fetch('/api/support/statistics', {
        credentials: 'include'
      })
        .then(response => response.json())
        .then(data => {
          if (data.success && data.statistics) {
            const stats = data.statistics;
            
            // Update availability stat
            const availabilityElement = document.getElementById('availability-stat');
            if (availabilityElement) {
              availabilityElement.textContent = `${stats.availability}%`;
            }
            
            // Update satisfaction stat
            const satisfactionElement = document.getElementById('satisfaction-stat');
            if (satisfactionElement) {
              satisfactionElement.textContent = `${stats.satisfaction}%`;
            }
            
            // Update response time stat
            const responseElement = document.getElementById('response-stat');
            if (responseElement) {
              responseElement.textContent = `<${stats.response_time}h`;
            }
          }
        })
        .catch(error => {
          console.error('Error loading support statistics:', error);
        });
    }

    // Load recent tickets from database
    function loadRecentTickets() {
      console.log('Loading recent tickets...');
      
      fetch('/api/support/tickets/recent', {
        credentials: 'include'
      })
        .then(response => {
          console.log('Recent tickets API response status:', response.status);
          return response.json();
        })
        .then(data => {
          console.log('Recent tickets API data:', data);
          const ticketsList = document.getElementById('recentTicketsList');
          
          if (!ticketsList) {
            console.error('recentTicketsList element not found');
            return;
          }
          
          if (data.success && data.tickets && data.tickets.length > 0) {
            console.log(`Found ${data.tickets.length} recent tickets`);
            ticketsList.innerHTML = '';
            data.tickets.forEach(ticket => {
              const statusColor = getStatusColor(ticket.status);
              const timeAgo = getTimeAgo(ticket.created_at);
              
              const ticketElement = document.createElement('div');
              ticketElement.className = 'flex items-center justify-between p-4 bg-white rounded-xl border border-gray-200 hover:shadow-md transition-all duration-200';
              
              ticketElement.innerHTML = `
                <div class="flex items-center gap-3 flex-1">
                  <div class="w-3 h-3 ${statusColor} rounded-full animate-pulse"></div>
                  <div class="flex-1">
                    <p class="font-semibold text-gray-900">${ticket.subject}</p>
                    <p class="text-sm text-gray-600">Ticket #${ticket.ticket_number} • ${ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</p>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="text-xs ${getStatusTextColor(ticket.status)} font-medium">${timeAgo}</span>
                  <button
                    onclick="viewTicketDetails('${ticket.id}')"
                    class="inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white text-xs font-medium rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-sm hover:shadow-md transform hover:-translate-y-0.5"
                    title="View ticket details"
                  >
                    <i data-lucide="eye" class="w-3 h-3 mr-1"></i>
                    View
                  </button>
                </div>
              `;
              
              ticketsList.appendChild(ticketElement);
            });
          } else {
            console.log('No recent tickets found or API error');
            ticketsList.innerHTML = `
              <div class="flex items-center justify-center p-8 text-gray-500">
                <i data-lucide="inbox" class="w-6 h-6 mr-2"></i>
                No recent tickets found
              </div>
            `;
          }
          lucide.createIcons();
        })
        .catch(error => {
          console.error('Error loading recent tickets:', error);
          const ticketsList = document.getElementById('recentTicketsList');
          if (ticketsList) {
            ticketsList.innerHTML = `
              <div class="flex items-center justify-center p-8 text-red-500">
                <i data-lucide="alert-circle" class="w-6 h-6 mr-2"></i>
                Failed to load recent tickets
              </div>
            `;
            lucide.createIcons();
          }
        });
    }

    // Handle support form submission
    async function handleSupportFormSubmit(event) {
      event.preventDefault();
      console.log('Support form submitted');
      
      const formData = new FormData(event.target);
      const ticketData = {
        category_id: formData.get('selectedCategory'),
        subject: formData.get('subject'),
        description: formData.get('description'),
        priority: formData.get('priority') || 'medium',
        user_name: formData.get('name'),
        user_email: formData.get('email')
      };
      
      console.log('Ticket data to submit:', ticketData);
      
      // Validate required fields
      if (!ticketData.category_id) {
        alert('Please select a support category');
        return;
      }
      if (!ticketData.subject || !ticketData.description) {
        alert('Please fill in both subject and description');
        return;
      }
      if (!ticketData.user_name || !ticketData.user_email) {
        alert('Please provide your name and email');
        return;
      }
      
      try {
        const response = await fetch('/api/support/tickets', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(ticketData)
        });
        
        const result = await response.json();
        console.log('Support ticket submission result:', result);
        
        if (result.success) {
          alert(`Support ticket submitted successfully! Ticket #${result.ticket_number}`);
          event.target.reset(); // Clear the form
          loadRecentTickets(); // Refresh recent tickets
        } else {
          alert(`Error submitting ticket: ${result.message}`);
        }
        
      } catch (error) {
        console.error('Error submitting support ticket:', error);
        alert('Error submitting support ticket. Please try again.');
      }
    }

    // Helper function to get status color
    function getStatusColor(status) {
      const colors = {
        'open': 'bg-blue-500',
        'in_progress': 'bg-yellow-500',
        'waiting': 'bg-orange-500',
        'resolved': 'bg-emerald-500',
        'closed': 'bg-gray-500'
      };
      return colors[status] || 'bg-gray-500';
    }

    // Helper function to get status text color
    function getStatusTextColor(status) {
      const colors = {
        'open': 'text-blue-600',
        'in_progress': 'text-yellow-600',
        'waiting': 'text-orange-600',
        'resolved': 'text-emerald-600',
        'closed': 'text-gray-600'
      };
      return colors[status] || 'text-gray-600';
    }

    // Helper function to get time ago
    function getTimeAgo(dateString) {
      const now = new Date();
      const date = new Date(dateString);
      const diffMs = now - date;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      
      if (diffDays === 0) {
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        if (diffHours === 0) {
          const diffMinutes = Math.floor(diffMs / (1000 * 60));
          return diffMinutes === 0 ? 'Just now' : `${diffMinutes} min ago`;
        }
        return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      } else if (diffDays === 1) {
        return '1 day ago';
      } else if (diffDays < 7) {
        return `${diffDays} days ago`;
      } else {
        const diffWeeks = Math.floor(diffDays / 7);
        return `${diffWeeks} week${diffWeeks > 1 ? 's' : ''} ago`;
      }
    }

    // Modal functionality for viewing ticket details
    function viewTicketDetails(ticketId) {
      console.log('Opening ticket details for ID:', ticketId);
      
      // Show modal with loading state
      const modal = document.getElementById('ticketModal');
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
      
      // Reset modal content to loading state
      document.getElementById('modalTicketNumber').textContent = 'Loading...';
      document.getElementById('modalSubject').textContent = 'Loading...';
      document.getElementById('modalDescription').innerHTML = '<p class="text-gray-600">Loading ticket description...</p>';
      document.getElementById('modalCategory').innerHTML = '<i data-lucide="folder" class="w-4 h-4"></i><span>Loading...</span>';
      document.getElementById('modalCreatedDate').innerHTML = '<i data-lucide="calendar" class="w-4 h-4"></i>Loading...';
      document.getElementById('modalUpdatedDate').innerHTML = '<i data-lucide="clock" class="w-4 h-4"></i>Loading...';
      
      // Fetch ticket details
      fetch(`/api/support/tickets/${ticketId}`, {
        credentials: 'include'
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('Ticket details received:', data);
          
          if (data.success && data.ticket) {
            const ticket = data.ticket;
            
            // Update modal content
            document.getElementById('modalTicketNumber').textContent = `Ticket #${ticket.ticket_number}`;
            document.getElementById('modalSubject').textContent = ticket.subject;
            
            // Update status and priority
            const statusElement = document.getElementById('modalTicketStatus');
            statusElement.textContent = ticket.status;
            statusElement.className = `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusBadgeColor(ticket.status.toLowerCase())}`;
            
            const priorityElement = document.getElementById('modalTicketPriority');
            priorityElement.textContent = ticket.priority;
            priorityElement.className = `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getPriorityBadgeColor(ticket.priority.toLowerCase())}`;
            
            // Update category
            const categoryIcon = getCategoryIconElement(ticket.category.icon);
            document.getElementById('modalCategory').innerHTML = `
              ${categoryIcon}
              <div>
                <span class="font-medium">${ticket.category.name}</span>
                ${ticket.category.description ? `<p class="text-xs text-gray-500 mt-1">${ticket.category.description}</p>` : ''}
              </div>
            `;
            
            // Update category icon in header
            const headerIcon = document.getElementById('modalCategoryIcon');
            headerIcon.innerHTML = categoryIcon;
            headerIcon.className = `w-8 h-8 ${getCategoryIconBgColor(ticket.category.name)} rounded-full flex items-center justify-center`;
            
            // Update description with proper formatting
            document.getElementById('modalDescription').innerHTML = `
              <div class="whitespace-pre-wrap text-gray-700 leading-relaxed">${ticket.description}</div>
            `;
            
            // Update timestamps
            document.getElementById('modalCreatedDate').innerHTML = `
              <i data-lucide="calendar" class="w-4 h-4"></i>
              ${ticket.created_date}
            `;
            
            document.getElementById('modalUpdatedDate').innerHTML = `
              <i data-lucide="clock" class="w-4 h-4"></i>
              ${ticket.updated_date}
            `;
            
            // Refresh icons
            lucide.createIcons();
            
          } else {
            showNotification(data.message || 'Failed to load ticket details', 'error');
            closeTicketModal();
          }
        })
        .catch(error => {
          console.error('Error loading ticket details:', error);
          showNotification('Failed to load ticket details. Please try again.', 'error');
          closeTicketModal();
        });
    }
    
    // Make closeTicketModal globally accessible
    window.closeTicketModal = function closeTicketModal() {
      console.log('closeTicketModal called'); // Debug log
      const modal = document.getElementById('ticketModal');
      if (modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = ''; // Restore body scroll
        console.log('Modal closed successfully'); // Debug log
      } else {
        console.error('Modal element not found');
      }
    }
    
    // Helper functions for modal styling
    function getStatusBadgeColor(status) {
      const colors = {
        'open': 'bg-blue-100 text-blue-800',
        'in progress': 'bg-yellow-100 text-yellow-800',
        'in_progress': 'bg-yellow-100 text-yellow-800',
        'waiting': 'bg-orange-100 text-orange-800',
        'resolved': 'bg-green-100 text-green-800',
        'closed': 'bg-gray-100 text-gray-800'
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    }
    
    function getPriorityBadgeColor(priority) {
      const colors = {
        'low': 'bg-green-100 text-green-800',
        'medium': 'bg-blue-100 text-blue-800',
        'high': 'bg-orange-100 text-orange-800',
        'critical': 'bg-red-100 text-red-800'
      };
      return colors[priority] || 'bg-gray-100 text-gray-800';
    }
    
    function getCategoryIconElement(iconName) {
      return `<i data-lucide="${iconName || 'help-circle'}" class="w-4 h-4 text-blue-600"></i>`;
    }
    
    function getCategoryIconBgColor(categoryName) {
      const colors = {
        'Technical Support': 'bg-blue-100',
        'Account Issues': 'bg-purple-100',
        'Billing Questions': 'bg-green-100',
        'Feature Request': 'bg-yellow-100',
        'Bug Report': 'bg-red-100',
        'Training Request': 'bg-indigo-100'
      };
      return colors[categoryName] || 'bg-blue-100';
    }

    // Character counter functionality
    function updateCharCounter() {
      const reviewText = document.getElementById('reviewText');
      const charCounter = document.getElementById('charCounter');
      
      if (reviewText && charCounter) {
        const currentLength = reviewText.value.length;
        charCounter.textContent = `${currentLength}/999 characters`;
        
        // Change color based on character count
        if (currentLength > 900) {
          charCounter.classList.add('text-red-500');
          charCounter.classList.remove('text-gray-500', 'text-yellow-500');
        } else if (currentLength > 800) {
          charCounter.classList.add('text-yellow-500');
          charCounter.classList.remove('text-gray-500', 'text-red-500');
        } else {
          charCounter.classList.add('text-gray-500');
          charCounter.classList.remove('text-red-500', 'text-yellow-500');
        }
      }
    }

    // Helper function to highlight star rating area when validation fails
    function highlightStarRating() {
      const starRating = document.getElementById('starRating');
      if (starRating) {
        starRating.classList.add('animate-pulse');
        starRating.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        starRating.style.borderRadius = '8px';
        starRating.style.padding = '8px';
        
        setTimeout(() => {
          starRating.classList.remove('animate-pulse');
          starRating.style.backgroundColor = '';
          starRating.style.borderRadius = '';
          starRating.style.padding = '';
        }, 2000);
      }
    }

    // Validate form in real-time
    function validateReviewForm() {
      const submitBtn = document.getElementById('submitReviewBtn');
      const reviewText = document.getElementById('reviewText').value.trim();
      const category = document.getElementById('reviewCategory').value;
      
      // Enable/disable submit button based on validation
      const isValid = selectedRating > 0 && category && reviewText.length <= 999;
      
      if (submitBtn) {
        if (isValid) {
          submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          submitBtn.disabled = false;
        } else {
          submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
          submitBtn.disabled = selectedRating === 0; // Only disable if no rating selected
        }
      }
      
      return isValid;
    }

    // Function to load real announcements from database
    async function loadAnnouncements() {
      try {
        console.log('Loading announcements from database...');
        const response = await fetch('/api/public/announcements?limit=5');
        const data = await response.json();
        
        if (data.success && data.announcements && data.announcements.length > 0) {
          displayAnnouncements(data.announcements);
        } else {
          console.log('No announcements found or failed to load');
          // Keep the static announcements as fallback
        }
      } catch (error) {
        console.error('Error loading announcements:', error);
        // Keep the static announcements as fallback
      }
    }

    // Function to display announcements in the UI
    function displayAnnouncements(announcements) {
      const announcementsList = document.getElementById('announcementsList');
      if (!announcementsList) return;

      // Store announcements globally for modal access
      window.currentAnnouncements = announcements;

      // Clear existing announcements
      announcementsList.innerHTML = '';

      announcements.forEach(announcement => {
        const announcementElement = createAnnouncementElement(announcement);
        announcementsList.appendChild(announcementElement);
      });
      
      // Refresh Lucide icons for dynamically created elements
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    // Function to create announcement element
    function createAnnouncementElement(announcement) {
      const div = document.createElement('div');
      
      // Map announcement types to colors and icons
      const typeConfig = {
        'system': { color: 'blue', bgColor: 'from-blue-50 to-indigo-50', border: 'border-blue-500', icon: 'rocket' },
        'maintenance': { color: 'amber', bgColor: 'from-amber-50 to-orange-50', border: 'border-amber-500', icon: 'wrench' },
        'feature': { color: 'emerald', bgColor: 'from-emerald-50 to-green-50', border: 'border-emerald-500', icon: 'sparkles' },
        'general': { color: 'blue', bgColor: 'from-blue-50 to-indigo-50', border: 'border-blue-500', icon: 'megaphone' }
      };

      const config = typeConfig[announcement.type] || typeConfig['general'];
      const iconName = announcement.icon || config.icon;
      
      div.className = `bg-gradient-to-r ${config.bgColor} border-l-4 ${config.border} rounded-xl p-6 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1`;
      
      div.innerHTML = `
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
              <i data-lucide="${iconName}" class="w-5 h-5 text-${config.color}-600"></i>
              <h3 class="text-lg font-bold text-${config.color}-900">${escapeHtml(announcement.title)}</h3>
              <span class="text-xs bg-${config.color}-100 text-${config.color}-700 px-2 py-1 rounded-full font-medium">${capitalizeFirst(announcement.type)}</span>
            </div>
            <p class="text-${config.color}-800 mb-3">${escapeHtml(announcement.content)}</p>
            <div class="flex items-center gap-4 text-sm text-${config.color}-600">
              <span class="flex items-center gap-1">
                <i data-lucide="calendar" class="w-4 h-4"></i>
                ${announcement.display_date}
              </span>
              <span class="flex items-center gap-1">
                <i data-lucide="user" class="w-4 h-4"></i>
                ${escapeHtml(announcement.author)}
              </span>
            </div>
          </div>
          <button 
            class="view-announcement-btn text-${config.color}-600 hover:text-${config.color}-700 p-2 hover:bg-${config.color}-100 rounded-lg transition-colors group" 
            data-announcement-id="${announcement.id}"
            title="View details"
          >
            <i data-lucide="eye" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
          </button>
        </div>
      `;
      
      return div;
    }

    // Helper function to escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Helper function to capitalize first letter
    function capitalizeFirst(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Modal control functions
    function showAnnouncementModal(announcement) {
      const modal = document.getElementById('announcementModal');
      const modalContent = document.getElementById('modalContent');
      const modalOverlay = document.getElementById('modalOverlay');
      
      if (!modal || !announcement) return;
      
      // Populate modal content
      populateModalContent(announcement);
      
      // Show modal with animation
      modal.classList.remove('hidden');
      
      // Trigger animation after a brief delay to ensure the element is rendered
      requestAnimationFrame(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      });
      
      // Prevent body scroll
      document.body.style.overflow = 'hidden';
    }

    function hideAnnouncementModal() {
      const modal = document.getElementById('announcementModal');
      const modalContent = document.getElementById('modalContent');
      
      if (!modal) return;
      
      // Hide with animation
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0');
      
      // Hide modal after animation completes
      setTimeout(() => {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }, 300);
    }

    function populateModalContent(announcement) {
      // Type configurations for styling
      const typeConfig = {
        'system': { color: 'blue', icon: 'rocket', bgGradient: 'from-blue-500 to-blue-600' },
        'maintenance': { color: 'amber', icon: 'wrench', bgGradient: 'from-amber-500 to-amber-600' },
        'feature': { color: 'emerald', icon: 'sparkles', bgGradient: 'from-emerald-500 to-emerald-600' },
        'general': { color: 'blue', icon: 'megaphone', bgGradient: 'from-blue-500 to-blue-600' }
      };

      const config = typeConfig[announcement.type] || typeConfig['general'];
      const iconName = announcement.icon || config.icon;

      // Update modal icon
      const modalIcon = document.getElementById('modalIcon');
      if (modalIcon) {
        modalIcon.className = `flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br ${config.bgGradient} text-white shadow-lg`;
        modalIcon.innerHTML = `<i data-lucide="${iconName}" class="w-6 h-6"></i>`;
      }

      // Update title
      const modalTitle = document.getElementById('modalTitle');
      if (modalTitle) {
        modalTitle.textContent = announcement.title;
      }

      // Update type badge
      const modalType = document.getElementById('modalType');
      if (modalType) {
        modalType.textContent = capitalizeFirst(announcement.type);
        modalType.className = `inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-${config.color}-100 text-${config.color}-700`;
      }

      // Update priority badge
      const modalPriority = document.getElementById('modalPriority');
      if (modalPriority) {
        const priorityColors = {
          'low': 'bg-gray-100 text-gray-700',
          'medium': 'bg-yellow-100 text-yellow-700',
          'high': 'bg-orange-100 text-orange-700',
          'critical': 'bg-red-100 text-red-700'
        };
        const priorityColor = priorityColors[announcement.priority] || priorityColors['medium'];
        modalPriority.textContent = `${capitalizeFirst(announcement.priority)} Priority`;
        modalPriority.className = `inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold ${priorityColor}`;
      }

      // Update content
      const modalContentDiv = document.querySelector('#modalContentText p');
      if (modalContentDiv) {
        modalContentDiv.textContent = announcement.content;
      }

      // Update meta information
      const modalAuthor = document.getElementById('modalAuthor');
      if (modalAuthor) {
        modalAuthor.textContent = announcement.author;
      }

      const modalDate = document.getElementById('modalDate');
      if (modalDate) {
        modalDate.textContent = announcement.display_date;
      }

      const modalTime = document.getElementById('modalTime');
      if (modalTime) {
        modalTime.textContent = announcement.display_time || 'Unknown';
      }

      const modalId = document.getElementById('modalId');
      if (modalId) {
        modalId.textContent = `#${announcement.id}`;
      }

      // Refresh Lucide icons for the modal
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    // Setup modal event listeners
    function setupModalEventListeners() {
      console.log('Setting up modal event listeners...'); // Debug log
      
      // Close modal events for ticket modal
      const closeTicketModalBtn = document.getElementById('closeTicketModalBtn');
      const closeTicketModalFooterBtn = document.getElementById('closeTicketModalFooterBtn');
      const ticketModal = document.getElementById('ticketModal');

      console.log('Modal elements found:', {
        closeTicketModalBtn: !!closeTicketModalBtn,
        closeTicketModalFooterBtn: !!closeTicketModalFooterBtn,
        ticketModal: !!ticketModal
      });

      if (closeTicketModalBtn) {
        closeTicketModalBtn.addEventListener('click', function(e) {
          console.log('Header close button clicked');
          e.preventDefault();
          e.stopPropagation();
          closeTicketModal();
        });
        console.log('Header close button listener added');
      } else {
        console.error('closeTicketModalBtn not found');
      }

      if (closeTicketModalFooterBtn) {
        closeTicketModalFooterBtn.addEventListener('click', function(e) {
          console.log('Footer close button clicked');
          e.preventDefault();
          e.stopPropagation();
          closeTicketModal();
        });
        console.log('Footer close button listener added');
      } else {
        console.error('closeTicketModalFooterBtn not found');
      }

      if (ticketModal) {
        ticketModal.addEventListener('click', function(e) {
          // Only close if clicking on the overlay itself, not the modal content
          if (e.target === ticketModal) {
            console.log('Modal overlay clicked');
            closeTicketModal();
          }
        });
        console.log('Modal overlay listener added');
      } else {
        console.error('ticketModal not found');
      }

      // Escape key to close modal
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const modal = document.getElementById('ticketModal');
          if (modal && !modal.classList.contains('hidden')) {
            console.log('Escape key pressed, closing modal');
            closeTicketModal();
          }
        }
      });
      console.log('Escape key listener added');

      // Share button event
      const shareBtn = document.getElementById('shareAnnouncementBtn');
      if (shareBtn) {
        shareBtn.addEventListener('click', function() {
          // Simple share functionality - copy URL to clipboard
          const url = window.location.href;
          if (navigator.clipboard) {
            navigator.clipboard.writeText(url).then(() => {
              // Visual feedback
              const originalText = shareBtn.innerHTML;
              shareBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4 mr-2"></i>Copied!';
              setTimeout(() => {
                shareBtn.innerHTML = originalText;
                if (typeof lucide !== 'undefined') {
                  lucide.createIcons();
                }
              }, 2000);
            });
          }
        });
      }

      // Handle announcement view button clicks (using event delegation)
      document.addEventListener('click', function(e) {
        if (e.target.closest('.view-announcement-btn')) {
          e.preventDefault();
          const button = e.target.closest('.view-announcement-btn');
          const announcementId = button.dataset.announcementId;
          
          // Find the announcement data
          const announcement = window.currentAnnouncements?.find(a => a.id === announcementId);
          if (announcement) {
            showAnnouncementModal(announcement);
          }
        }
      });
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded - Initializing page...');
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      
      // Load real announcements from database
      loadAnnouncements();
      
      // Load FAQ data from database
      loadFAQData();
      
      // Set up character counter and form validation
      const reviewTextArea = document.getElementById('reviewText');
      const reviewCategory = document.getElementById('reviewCategory');
      
      if (reviewTextArea) {
        reviewTextArea.addEventListener('input', function() {
          updateCharCounter();
          validateReviewForm();
        });
        updateCharCounter(); // Initialize counter
      }
      
      if (reviewCategory) {
        reviewCategory.addEventListener('change', validateReviewForm);
      }
      
      // Add validation to star rating clicks
      document.querySelectorAll('.star-btn').forEach(star => {
        const originalClickHandler = star.onclick;
        star.addEventListener('click', function() {
          setTimeout(validateReviewForm, 100); // Allow rating to be set first
        });
      });
      
      // Initialize form validation
      validateReviewForm();
      // Load dynamic content
      loadSupportCategories();
      loadSupportStatistics();
      loadRecentTickets();
      
      // Handle support form submission
      const supportForm = document.getElementById('ticketForm');
      if (supportForm) {
        supportForm.addEventListener('submit', handleSupportFormSubmit);
        console.log('Support form event listener added');
      } else {
        console.warn('Support form not found - looking for ticketForm');
      }
      
      // Handle category selection
      document.addEventListener('click', function(e) {
        if (e.target && e.target.matches('.category-button')) {
          e.preventDefault();
          // Visual feedback
          document.querySelectorAll('.category-button').forEach(btn =>
            btn.classList.remove('bg-blue-600', 'text-white')
          );
          e.target.classList.add('bg-blue-600', 'text-white');
          
          // Set selected category
          const categoryId = e.target.dataset.categoryId;
          const categoryName = e.target.textContent.trim();
          const selectedCategoryInput = document.getElementById('selectedCategory');
          if (selectedCategoryInput) {
            selectedCategoryInput.value = categoryId;
            console.log(`Selected category: ${categoryName} (ID: ${categoryId})`);
          }
        }
      });
      
      // Setup modal event listeners
      setupModalEventListeners();
      
      // Add fade-in animation to elements
      const elements = document.querySelectorAll('#infoHeader, #announcementsSection, #supportTicketingSection, #reviewSection, #systemInfo, #quickLinks, #faqSection, #contactSection');
      elements.forEach((el, index) => {
        if (el) {
          setTimeout(() => {
            el.style.animation = `fadeInUp 0.6s ease-out ${index * 0.1}s both`;
          }, 100);
        }
      });
    });
  </script>

</body>
{% endblock %}

</html>