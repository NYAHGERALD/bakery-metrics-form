<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bakery Analytics Dashboard</title>
    <link href="{{ url_for('static', filename='css/output.css') }}" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        },
                        success: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        warning: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        },
                        danger: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'slide-in-left': 'slideInLeft 0.5s ease-out',
                        'slide-in-right': 'slideInRight 0.5s ease-out',
                        'pulse-slow': 'pulse 3s infinite',
                        'bounce-subtle': 'bounceSubtle 2s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'scale-in': 'scaleIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideInLeft: {
                            '0%': { opacity: '0', transform: 'translateX(-30px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' }
                        },
                        slideInRight: {
                            '0%': { opacity: '0', transform: 'translateX(30px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-3px)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.3)' },
                            '100%': { boxShadow: '0 0 30px rgba(59, 130, 246, 0.6)' }
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
                    }
                }
            }
        }
    </script>

    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-glow {
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.2);
        }

        .metric-card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            transition: stroke-dashoffset 0.6s ease-in-out;
        }

        .blink {
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        .notification-dot {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .sidebar-gradient {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        }

        .button-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }

        .button-gradient:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .card-gradient {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
        }

        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }

            100% {
                background-position: 200% 0;
            }
        }

        .floating-icon {
            animation: float 3s ease-in-out infinite;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }




        /* Enhanced Navigation States */
        .nav-link {
            position: relative;
            overflow: hidden;
            transform: translateY(0);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            transform: translateY(-2px) scale(1.02);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2), 0 0 0 1px rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .nav-link:hover i {
            transform: scale(1.1) rotate(5deg);
            color: #60a5fa;
        }

        .nav-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(147, 51, 234, 0.25) 100%);
            color: #93c5fd !important;
            border: 1px solid rgba(59, 130, 246, 0.4);
            backdrop-filter: blur(15px);
            transform: translateY(-1px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 0 4px 4px 0;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
            animation: pulse-glow 2s ease-in-out infinite alternate;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }
            100% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.8); }
        }

        .nav-link.loading {
            pointer-events: none;
            opacity: 0.7;
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.2) 0%, rgba(71, 85, 105, 0.2) 100%);
        }

        .nav-link.loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Mobile Navigation Enhancements */
        .nav-link-mobile {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
        }

        .nav-link-mobile:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        .nav-link-mobile.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(147, 51, 234, 0.25) 100%);
            color: #93c5fd !important;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transform: translateX(6px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .nav-link-mobile.active::before {
            content: '';
            position: absolute;
            left: -1px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 60%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 0 2px 2px 0;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .nav-link-mobile.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .nav-link-mobile.loading i {
            animation: spin 1s linear infinite;
        }

        /* Enhanced Tooltip Styles */
        .tooltip-container {
            position: relative;
        }

        .tooltip-container::after {
            content: attr(data-tooltip);
            position: absolute;
            left: calc(100% + 16px);
            top: 50%;
            transform: translateY(-50%);
            padding: 10px 14px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);
            color: white;
            font-size: 13px;
            font-weight: 500;
            border-radius: 10px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05);
            pointer-events: none;
        }

        .tooltip-container::before {
            content: '';
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: rgba(0, 0, 0, 0.95);
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10000;
            pointer-events: none;
        }

        .tooltip-container:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(8px);
        }

        .tooltip-container:hover::before {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) translateX(8px);
        }

        /* Responsive Tooltip Behavior */
        @media (max-width: 1024px) {
            .tooltip-container::after,
            .tooltip-container::before {
                display: none !important;
            }
        }

        /* Loading indicator for page transitions */
        .page-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .page-loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Loading Indicators */
        .loading-indicator {
            transition: opacity 0.3s ease;
        }

        .nav-link.loading .loading-indicator,
        .nav-link-mobile.loading .loading-indicator {
            opacity: 1 !important;
        }

        .nav-link:not(.loading) .loading-indicator,
        .nav-link-mobile:not(.loading) .loading-indicator {
            opacity: 0;
        }

        /* Enhanced sidebar responsiveness */
        @media (max-width: 1024px) {
            .tooltip-container::after,
            .tooltip-container::before {
                display: none !important;
            }
            
            /* Ensure mobile sidebar animations are smooth */
            #mobileSidebar {
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            #mobileSidebar .nav-link-mobile {
                transform: translateX(-20px);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            #mobileSidebar:not(.-translate-x-full) .nav-link-mobile {
                transform: translateX(0);
            }
        }

        /* Additional hover effects for better UX */
        .nav-link:hover .loading-indicator {
            opacity: 0 !important;
        }

        .nav-link-mobile:hover .loading-indicator {
            opacity: 0 !important;
        }

        /* Improved focus states for accessibility */
        .nav-link:focus,
        .nav-link-mobile:focus {
            outline: 2px solid rgba(59, 130, 246, 0.5);
            outline-offset: 2px;
        }

        /* Smooth transitions for all interactive elements */
        .nav-link i,
        .nav-link-mobile i {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Settings Toggle Switches */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #3b82f6;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(16px);
        }

        /* Dark mode styles */
        .dark {
            background-color: #1f2937;
            color: #f9fafb;
        }

        .dark .bg-white {
            background-color: #374151 !important;
        }

        .dark .text-gray-900 {
            color: #f9fafb !important;
        }

        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }

        /* Custom scrollbar for sidebar */
        #sidebar .overflow-y-auto::-webkit-scrollbar,
        #mobileSidebar .overflow-y-auto::-webkit-scrollbar {
            width: 4px;
        }

        #sidebar .overflow-y-auto::-webkit-scrollbar-track,
        #mobileSidebar .overflow-y-auto::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.1);
            border-radius: 2px;
        }

        #sidebar .overflow-y-auto::-webkit-scrollbar-thumb,
        #mobileSidebar .overflow-y-auto::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 2px;
        }

        #sidebar .overflow-y-auto::-webkit-scrollbar-thumb:hover,
        #mobileSidebar .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.5);
        }

        /* Ensure sidebar content fits properly */
        #sidebar {
            height: 100vh;
            max-height: 100vh;
        }

        #mobileSidebar {
            height: 100vh;
            max-height: 100vh;
        }

        /* Secondary Sidebar Styles */
        .secondary-sidebar {
            position: fixed;
            left: 320px; /* Width of main sidebar */
            top: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 49;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            visibility: hidden;
            opacity: 0;
        }

        .secondary-sidebar.open {
            transform: translateX(0);
            visibility: visible;
            opacity: 1;
        }

        .secondary-sidebar-mobile {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 51;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            visibility: hidden;
            opacity: 0;
        }

        .secondary-sidebar-mobile.open {
            transform: translateX(0);
            visibility: visible;
            opacity: 1;
        }

        /* Tablet secondary sidebar - positioned next to main sidebar */
        @media (min-width: 768px) and (max-width: 1023px) {
            .secondary-sidebar-mobile {
                left: 320px;
                width: calc(100vw - 320px);
                max-width: 300px;
            }
            
            .secondary-sidebar-mobile.open {
                transform: translateX(0);
            }
        }

        /* Mobile phone secondary sidebar - full screen overlay */
        @media (max-width: 767px) {
            .secondary-sidebar-mobile {
                left: 0;
                width: 100vw;
                background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
                backdrop-filter: blur(10px);
            }
            
            .secondary-sidebar-mobile .p-6 {
                padding: 1.5rem 1rem;
            }
            
            .secondary-sidebar-mobile .space-y-3 > * {
                margin-bottom: 0.5rem;
            }
            
            .secondary-sidebar-mobile .secondary-nav-link {
                padding: 1rem;
                font-size: 1.1rem;
            }
        }

        /* Grouped button styles */
        .grouped-nav-trigger {
            position: relative;
        }

        .grouped-nav-trigger::after {
            content: '';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid #94a3b8;
            border-top: 3px solid transparent;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .grouped-nav-trigger.active::after {
            border-left-color: #60a5fa;
            transform: translateY(-50%) rotate(90deg);
        }

        .grouped-nav-trigger:hover::after {
            border-left-color: #60a5fa;
        }

        /* Secondary sidebar navigation links */
        .secondary-nav-link {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
        }

        .secondary-nav-link:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 51, 234, 0.15) 100%);
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        .secondary-nav-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(147, 51, 234, 0.25) 100%);
            color: #93c5fd !important;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transform: translateX(6px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .secondary-nav-link.active::before {
            content: '';
            position: absolute;
            left: -1px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 60%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 0 2px 2px 0;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* Animation delays for secondary sidebar items */
        .secondary-sidebar .secondary-nav-link:nth-child(1) { animation-delay: 0.1s; }
        .secondary-sidebar .secondary-nav-link:nth-child(2) { animation-delay: 0.2s; }
        .secondary-sidebar .secondary-nav-link:nth-child(3) { animation-delay: 0.3s; }

        .secondary-sidebar.open .secondary-nav-link {
            animation: slide-in-scale 0.4s ease-out forwards;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 1024px) {
            .secondary-sidebar {
                display: none;
            }
        }
        
        /* Enhanced touch targets for mobile */
        @media (max-width: 767px) {
            .secondary-sidebar-mobile .secondary-nav-link {
                padding: 1.25rem 1rem;
                min-height: 60px;
                font-size: 1.1rem;
                border-radius: 16px;
                margin-bottom: 0.75rem;
            }
            
            .secondary-sidebar-mobile .secondary-nav-link i {
                width: 1.5rem;
                height: 1.5rem;
            }
            
            .secondary-sidebar-mobile h3 {
                font-size: 1.25rem;
            }
        }
        
        /* Tablet adjustments */
        @media (min-width: 768px) and (max-width: 1023px) {
            .secondary-sidebar-mobile .secondary-nav-link {
                padding: 1rem;
                font-size: 1rem;
            }
        }
        
        /* Add swipe gesture support */
        .secondary-sidebar-mobile {
            touch-action: pan-x;
        }
        
        /* Overlay for mobile secondary sidebar */
        .secondary-sidebar-mobile::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .secondary-sidebar-mobile.open::before {
            opacity: 1;
        }
        
        @media (min-width: 768px) {
            .secondary-sidebar-mobile::before {
                display: none;
            }
        }

        /* Enhanced Performance Targets Progress Bars */
        #performanceTargetsCard .w-full.bg-gray-200 {
            position: relative;
            overflow: hidden;
        }

        #performanceTargetsCard .w-full.bg-gray-200::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        #performanceTargetsCard .w-full.bg-gray-200:hover::before {
            left: 100%;
        }

        /* Enhanced progress bar animations */
        #uptimeTargetProgress {
            background-size: 200% 100%;
            position: relative;
        }

        #uptimeTargetProgress.target-met {
            animation: progress-shimmer 2s ease-in-out infinite;
        }

        @keyframes progress-shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Target achievement indicator */
        .target-achievement-badge {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .target-achievement-badge.show {
            opacity: 1;
        }

        /* Loading spinner for page overlay */
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Enhanced Quick Overview Styles */
        #sidebarQuickStats {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #sidebarQuickStats:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
        }

        /* Quick Overview Item Hover Effects */
        #sidebarQuickStats .group:hover {
            transform: translateX(4px);
            background: rgba(51, 65, 85, 0.6);
        }

        #sidebarQuickStats .group:hover i {
            transform: scale(1.1);
        }

        /* Performance Bar Animation */
        #performanceBar {
            background-size: 200% 100%;
            animation: performance-flow 3s ease-in-out infinite;
        }

        @keyframes performance-flow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Pulsing Dots Animation */
        .animate-pulse-dot {
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
                box-shadow: 0 0 0 0 currentColor;
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.2);
                box-shadow: 0 0 0 4px transparent;
            }
        }

        /* Status Indicators */
        .status-indicator {
            position: relative;
        }

        .status-indicator::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 50%;
            background: linear-gradient(45deg, currentColor, transparent, currentColor);
            animation: rotate-indicator 2s linear infinite;
            z-index: -1;
        }

        @keyframes rotate-indicator {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Gradient Text Effects */
        .gradient-text {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Overview Card Stagger Animation */
        #sidebarQuickStats .space-y-5 > div {
            animation: slide-in-scale 0.6s ease-out;
        }

        #sidebarQuickStats .space-y-5 > div:nth-child(1) { animation-delay: 0.1s; }
        #sidebarQuickStats .space-y-5 > div:nth-child(2) { animation-delay: 0.2s; }
        #sidebarQuickStats .space-y-5 > div:nth-child(3) { animation-delay: 0.3s; }
        #sidebarQuickStats .space-y-5 > div:nth-child(4) { animation-delay: 0.4s; }

        @keyframes slide-in-scale {
            0% {
                opacity: 0;
                transform: translateX(-20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }
    </style>

    <style>
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .float {
            animation: float 3s ease-in-out infinite;
        }

        /* Replace animate-pulse with float for subtle movement */
        #contentOverlay .animate-pulse {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 text-gray-900 min-h-screen">
    <!-- Page Loading Overlay -->
    <div id="pageLoadingOverlay" class="page-loading-overlay">
        <div class="text-center">
            <div class="loading-spinner"></div>
            <p class="text-white mt-4 font-medium">Loading...</p>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="flex h-screen">
        <!-- Desktop Sidebar -->
        <aside id="sidebar" class="hidden lg:flex flex-col w-80 sidebar-gradient shadow-2xl relative overflow-hidden">
            <!-- Decorative elements -->
            <div
                class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-400/20 to-transparent rounded-full -translate-y-16 translate-x-16">
            </div>
            <div
                class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-purple-400/20 to-transparent rounded-full translate-y-12 -translate-x-12">
            </div>

            <div class="flex-1 flex flex-col h-full overflow-hidden">
                <div class="p-8 relative z-10 flex-shrink-0">
                    <!-- Logo Section -->
                    <div class="flex items-center space-x-4 mb-8 animate-slide-in-left">
                        <div class="p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-lg floating-icon">
                            <i data-lucide="layout-dashboard" class="w-8 h-8 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">Bakery</h1>
                        </div>
                    </div>
                </div>

                <!-- Scrollable Content Area -->
                <div class="flex-1 px-8 pb-8 relative z-10">

                <!-- Navigation -->
                <nav class="space-y-2">
                    <div class="relative group animate-slide-in-left tooltip-container" style="animation-delay: 0.1s"
                        data-tooltip="Main dashboard with key performance metrics">
                        <a href="/dashboard" data-page="dashboard" id="dashboard-nav"
                            class="nav-link flex items-center space-x-4 px-4 py-3 rounded-2xl text-slate-300 hover:bg-slate-700/50 hover:text-white transition-all duration-300 group">
                            <i data-lucide="home" class="w-5 h-5 transition-all duration-300"></i>
                            <span class="font-semibold">Dashboard</span>
                            <div class="loading-indicator opacity-0 ml-auto">
                                <div class="w-4 h-4 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                            </div>
                        </a>
                    </div>

                    <div class="relative group animate-slide-in-left tooltip-container" style="animation-delay: 0.2s"
                        data-tooltip="View detailed analytics and reports">
                        <a href="/report" data-page="report" id="report-nav"
                            class="nav-link flex items-center space-x-4 px-4 py-3 rounded-2xl text-slate-300 hover:bg-slate-700/50 hover:text-white transition-all duration-300 group">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                            <span class="font-semibold">Bakery Metrics</span>
                            <div class="loading-indicator opacity-0 ml-auto">
                                <div class="w-4 h-4 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                            </div>
                        </a>
                    </div>

                    <div class="relative group animate-slide-in-left tooltip-container" style="animation-delay: 0.3s"
                        data-tooltip="Submit new operational data and metrics">
                        <a href="/form" data-page="form" id="form-nav"
                            class="nav-link flex items-center space-x-4 px-4 py-3 rounded-2xl text-slate-300 hover:bg-slate-700/50 hover:text-white transition-all duration-300 group">
                            <i data-lucide="file-text" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                            <span class="font-semibold">Submit Data</span>
                            <div class="loading-indicator opacity-0 ml-auto">
                                <div class="w-4 h-4 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                            </div>
                        </a>
                    </div>

                    <!-- Desktop Sidebar - Enhanced Machine Issues Button -->
                    <div class="relative group animate-slide-in-left tooltip-container" style="animation-delay: 0.4s"
                        data-tooltip="Report and track operational issues">
                        <a href="/issues" data-page="issues" id="issues-nav"
                            class="nav-link flex items-center space-x-4 px-4 py-3 rounded-2xl text-slate-300 hover:bg-slate-700/50 hover:text-white transition-all duration-300 group">
                            <i data-lucide="alert-triangle"
                                class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                            <span class="font-semibold">Report Machine Issues</span>
                            <div class="loading-indicator opacity-0 ml-auto">
                                <div class="w-4 h-4 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                            </div>
                        </a>
                    </div>

                    <!-- Grouped Navigation Trigger -->
                    <div class="relative group animate-slide-in-left tooltip-container" style="animation-delay: 0.5s"
                        data-tooltip="Inventory management and support tools">
                        <button type="button" id="managementMenuTrigger"
                            class="nav-link grouped-nav-trigger flex items-center space-x-4 px-4 py-3 rounded-2xl text-slate-300 hover:bg-slate-700/50 hover:text-white transition-all duration-300 group w-full">
                            <i data-lucide="layers" class="w-5 h-5 group-hover:scale-110 transition-transform duration-300"></i>
                            <span class="font-semibold">Management</span>
                        </button>
                    </div>

                </nav>

                <!-- Enhanced Quick Overview -->
                <div id="sidebarQuickStats" class="mt-10 p-6 glass-dark rounded-2xl animate-slide-in-left border border-slate-600/30 relative overflow-hidden"
                    style="animation-delay: 0.6s">
                    <!-- Background decorative elements -->
                    <div class="absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-cyan-400/10 to-transparent rounded-full -translate-y-8 translate-x-8"></div>
                    <div class="absolute bottom-0 left-0 w-12 h-12 bg-gradient-to-tr from-purple-400/10 to-transparent rounded-full translate-y-6 -translate-x-6"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-sm font-bold text-white">Quick Overview</h3>
                            <div class="flex items-center space-x-1">
                                <div class="w-1 h-1 bg-cyan-400 rounded-full animate-pulse"></div>
                                <div class="w-1 h-1 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                                <div class="w-1 h-1 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-5">
                            <!-- System Status -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-cyan-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-lg">
                                        <i data-lucide="server" class="w-4 h-4 text-cyan-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">System Status</span>
                                        <div class="text-xs text-slate-500">Operational Health</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse shadow-lg shadow-emerald-400/50"></div>
                                    <span class="text-xs font-bold text-emerald-400">Online</span>
                                </div>
                            </div>

                            <!-- Data Sync -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-purple-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-lg">
                                        <i data-lucide="refresh-cw" class="w-4 h-4 text-purple-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Data Sync</span>
                                        <div class="text-xs text-slate-500">Last Updated</div>
                                    </div>
                                </div>
                                <span class="text-xs font-bold text-purple-400" id="lastSyncTime">Just now</span>
                            </div>

                            <!-- Active Users -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-orange-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 bg-gradient-to-br from-orange-500/20 to-yellow-500/20 rounded-lg">
                                        <i data-lucide="users" class="w-4 h-4 text-orange-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Active Users</span>
                                        <div class="text-xs text-slate-500">Current Session</div>
                                    </div>
                                </div>
                                <span class="text-xs font-bold text-orange-400" id="activeUsersCount">1</span>
                            </div>

                            <!-- Database Status -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-green-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-lg">
                                        <i data-lucide="database" class="w-4 h-4 text-green-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Database</span>
                                        <div class="text-xs text-slate-500">Connection Status</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50"></div>
                                    <span class="text-xs font-bold text-green-400" id="dbStatus">Connected</span>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Indicator -->
                        <div class="mt-6 pt-4 border-t border-slate-600/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-300">System Performance</span>
                                <span class="text-xs font-bold text-cyan-400" id="performanceScore">98%</span>
                            </div>
                            <div class="w-full bg-slate-700/50 rounded-full h-2 overflow-hidden">
                                <div id="performanceBar" class="bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-cyan-400/30" style="width: 98%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                </div> <!-- End of scrollable content area -->
            </div> <!-- End of flex container -->
        </aside>

        <!-- Desktop Secondary Sidebar -->
        <aside id="secondarySidebar" class="secondary-sidebar hidden lg:block">
            <div class="p-6 h-full">
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-white mb-2">Management Tools</h3>
                    <p class="text-slate-400 text-sm">Inventory and support options</p>
                </div>
                
                <nav class="space-y-3">
                    <a href="/inventory" data-page="inventory" id="inventory-nav"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="package" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Inventory</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <a href="/inventory-overview" data-page="inventory-overview" id="inventory-overview-nav"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="trending-up" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Inventory Tracking</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <a href="/help" data-page="help" id="help-nav"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="help-circle" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Help Center</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                </nav>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div id="mobileSidebarOverlay"
            class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden backdrop-blur-sm"></div>

        <!-- Mobile Sidebar -->
        <aside id="mobileSidebar"
            class="fixed inset-y-0 left-0 w-80 sidebar-gradient shadow-2xl z-50 lg:hidden transform -translate-x-full transition-transform duration-300">
            <div class="p-6 h-full overflow-y-auto">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl">
                            <i data-lucide="layout-dashboard" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold text-white">Bakery</h1>
                        </div>
                    </div>
                    <button id="closeMobileSidebar" class="p-2 hover:bg-slate-700 rounded-lg transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>

                <nav class="space-y-2">
                    <a href="/dashboard" data-page="dashboard" id="dashboard-nav-mobile"
                        class="nav-link-mobile flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="home" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Dashboard</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    <a href="/report" data-page="report" id="report-nav-mobile"
                        class="nav-link-mobile flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Bakery Metrics</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    <a href="/form" data-page="form" id="form-nav-mobile"
                        class="nav-link-mobile flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="file-text" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Submit Data</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    <!-- Mobile Sidebar - Enhanced Machine Issues Button -->
                    <a href="/issues" data-page="issues" id="issues-nav-mobile"
                        class="nav-link-mobile flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="alert-triangle" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Report Machine Issues</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <!-- Mobile Grouped Navigation Trigger -->
                    <button type="button" id="managementMenuTriggerMobile"
                        class="nav-link-mobile grouped-nav-trigger flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300 w-full">
                        <i data-lucide="layers" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Management</span>
                    </button>
                </nav>

                <!-- Mobile Quick Overview Section -->
                <div id="mobileQuickStats" class="mt-8 p-5 glass-dark rounded-2xl border border-slate-600/30 relative overflow-hidden">
                    <!-- Background decorative elements -->
                    <div class="absolute top-0 right-0 w-12 h-12 bg-gradient-to-bl from-cyan-400/10 to-transparent rounded-full -translate-y-6 translate-x-6"></div>
                    <div class="absolute bottom-0 left-0 w-10 h-10 bg-gradient-to-tr from-purple-400/10 to-transparent rounded-full translate-y-5 -translate-x-5"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-sm font-bold text-white">Quick Overview</h3>
                            <div class="flex items-center space-x-1">
                                <div class="w-1 h-1 bg-cyan-400 rounded-full animate-pulse"></div>
                                <div class="w-1 h-1 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                                <div class="w-1 h-1 bg-blue-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- System Status -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-cyan-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-1.5 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-lg">
                                        <i data-lucide="server" class="w-3.5 h-3.5 text-cyan-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">System Status</span>
                                        <div class="text-xs text-slate-500">Operational Health</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse shadow-lg shadow-emerald-400/50"></div>
                                    <span class="text-xs font-bold text-emerald-400">Online</span>
                                </div>
                            </div>

                            <!-- Data Sync -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-purple-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-1.5 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-lg">
                                        <i data-lucide="refresh-cw" class="w-3.5 h-3.5 text-purple-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Data Sync</span>
                                        <div class="text-xs text-slate-500">Last Updated</div>
                                    </div>
                                </div>
                                <span class="text-xs font-bold text-purple-400" id="mobileLastSyncTime">Just now</span>
                            </div>

                            <!-- Active Users -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-orange-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-1.5 bg-gradient-to-br from-orange-500/20 to-yellow-500/20 rounded-lg">
                                        <i data-lucide="users" class="w-3.5 h-3.5 text-orange-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Active Users</span>
                                        <div class="text-xs text-slate-500">Current Session</div>
                                    </div>
                                </div>
                                <span class="text-xs font-bold text-orange-400" id="mobileActiveUsersCount">1</span>
                            </div>

                            <!-- Database Status -->
                            <div class="flex justify-between items-center p-3 bg-slate-800/40 backdrop-blur-sm rounded-xl border border-slate-600/20 hover:border-green-400/30 transition-all duration-300 group">
                                <div class="flex items-center space-x-3">
                                    <div class="p-1.5 bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-lg">
                                        <i data-lucide="database" class="w-3.5 h-3.5 text-green-400"></i>
                                    </div>
                                    <div>
                                        <span class="text-xs font-medium text-slate-300">Database</span>
                                        <div class="text-xs text-slate-500">Connection Status</div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse shadow-lg shadow-green-400/50"></div>
                                    <span class="text-xs font-bold text-green-400" id="mobileDbStatus">Connected</span>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Indicator -->
                        <div class="mt-5 pt-4 border-t border-slate-600/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-300">System Performance</span>
                                <span class="text-xs font-bold text-cyan-400" id="mobilePerformanceScore">98%</span>
                            </div>
                            <div class="w-full bg-slate-700/50 rounded-full h-1.5 overflow-hidden">
                                <div id="mobilePerformanceBar" class="bg-gradient-to-r from-cyan-400 to-blue-500 h-1.5 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-cyan-400/30" style="width: 98%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Mobile Secondary Sidebar -->
        <aside id="secondarySidebarMobile" class="secondary-sidebar-mobile lg:hidden">
            <div class="p-6 h-full overflow-y-auto">
                <!-- Mobile Header with Close Button -->
                <div class="flex items-center justify-between mb-6 lg:hidden">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl">
                            <i data-lucide="package" class="w-5 h-5 text-white"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white">Management Tools</h3>
                    </div>
                    <button id="closeSecondaryMobile" class="p-2 hover:bg-slate-700/50 rounded-xl transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>
                
                <!-- Desktop Header (hidden on mobile) -->
                <div class="mb-6 hidden lg:block">
                    <h3 class="text-lg font-bold text-white mb-2">Management Tools</h3>
                    <p class="text-slate-400 text-sm">Inventory and support options</p>
                </div>
                
                <nav class="space-y-3">
                    <a href="/inventory" data-page="inventory" id="inventory-nav-mobile"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="package" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Inventory</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <a href="/inventory-overview" data-page="inventory-overview" id="inventory-overview-nav-mobile"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="trending-up" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Inventory Tracking</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <a href="/help" data-page="help" id="help-nav-mobile"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="help-circle" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Help Center</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                    
                    <a href="/rca" data-page="rca" id="rca-nav-mobile"
                        class="secondary-nav-link flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-all duration-300">
                        <i data-lucide="search" class="w-5 h-5 transition-all duration-300"></i>
                        <span class="font-medium">Root Cause Analysis</span>
                        <div class="loading-indicator opacity-0 ml-auto">
                            <div class="w-3 h-3 border-2 border-slate-400 border-t-blue-400 rounded-full animate-spin"></div>
                        </div>
                    </a>
                </nav>
                
                <!-- Mobile-only bottom spacing -->
                <div class="block lg:hidden mt-8 pt-4 border-t border-slate-700/50">
                    <p class="text-xs text-slate-500 text-center">Swipe left or tap ✕ to close</p>
                </div>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white/80 backdrop-blur-xl shadow-sm border-b border-gray-200/50 sticky top-0 z-30">
                <div class="flex items-center justify-between px-6 py-4">
                    <!-- Left Section -->
                    <div class="flex items-center space-x-4 animate-slide-in-left">
                        <button id="mobileMenuBtn" class="lg:hidden p-2 hover:bg-gray-100 rounded-xl transition-colors">
                            <i data-lucide="menu" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <div>
                            <h1
                                class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">
                                Dashboard Overview</h1>
                            <p class="text-sm text-gray-500 font-medium">Real-time bakery performance metrics</p>
                        </div>
                    </div>

                    <!-- Center Section - Live Clock -->
                    <div id="headerClock" class="hidden md:flex flex-col items-center animate-scale-in">
                        <div
                            class="flex items-center space-x-1 text-xl font-mono font-bold text-gray-900 bg-white/50 px-4 py-2 rounded-xl backdrop-blur-sm border border-gray-200">
                            <span id="hour">--</span>
                            <span class="blink">:</span>
                            <span id="minute">--</span>
                            <span class="blink">:</span>
                            <span id="second">--</span>
                            <span id="ampm" class="ml-1 text-sm">--</span>
                        </div>
                        <div id="clockDate" class="text-xs text-gray-500 mt-1">Loading...</div>
                    </div>

                    <!-- Right Section -->
                    <div class="flex items-center space-x-3 animate-slide-in-right">
                        <!-- Notifications -->
                        <button id="notificationBtn"
                            class="relative p-3 hover:bg-gray-100 rounded-xl transition-all duration-300 group hover:shadow-lg">
                            <i data-lucide="bell"
                                class="w-6 h-6 text-gray-600 group-hover:scale-110 group-hover:text-blue-600 transition-all duration-300"></i>
                            <!-- Notification Badge with Count -->
                            <div id="notificationBadge"
                                class="absolute -top-1 -right-1 min-w-[20px] h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center px-1.5 shadow-lg border-2 border-white hidden animate-pulse">
                                <span id="notificationCount">0</span>
                            </div>
                        </button>

                        <!-- Settings -->
                        <div class="relative">
                            <button id="settingsBtn"
                                class="p-3 hover:bg-gray-100 rounded-xl transition-all duration-300 group">
                                <i data-lucide="settings"
                                    class="w-5 h-5 text-gray-600 group-hover:rotate-90 group-hover:scale-110 transition-all duration-300"></i>
                            </button>

                            <!-- Settings Dropdown -->
                            <div id="settingsDropdown"
                                class="hidden absolute right-0 mt-2 w-64 bg-white rounded-2xl shadow-xl border border-gray-200 z-50 overflow-hidden">
                                <div class="p-2">
                                    <!-- Settings Header -->
                                    <div class="px-3 py-2 border-b border-gray-100">
                                        <h3 class="text-sm font-semibold text-gray-900 flex items-center">
                                            <i data-lucide="settings" class="w-4 h-4 mr-2 text-blue-600"></i>
                                            App Settings
                                        </h3>
                                    </div>

                                    <!-- Theme Settings -->
                                    <div class="py-2">
                                        <div class="px-3 py-2">
                                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Appearance</span>
                                        </div>
                                        <button id="themeToggle"
                                            class="w-full flex items-center justify-between px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <div class="flex items-center space-x-2">
                                                <i data-lucide="palette" class="w-4 h-4 text-gray-500"></i>
                                                <span class="text-sm text-gray-700">Dark Mode</span>
                                            </div>
                                            <div class="relative">
                                                <input type="checkbox" id="darkModeToggle" class="sr-only">
                                                <div class="w-10 h-6 bg-gray-200 rounded-full shadow-inner transition-colors duration-300"></div>
                                                <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300"></div>
                                            </div>
                                        </button>
                                    </div>

                                    <!-- Notification Settings -->
                                    <div class="py-2">
                                        <div class="px-3 py-2">
                                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Notifications</span>
                                        </div>
                                        <button id="notificationSettings"
                                            class="w-full flex items-center space-x-2 px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <i data-lucide="bell-ring" class="w-4 h-4 text-gray-500"></i>
                                            <span class="text-sm text-gray-700">Notification Preferences</span>
                                        </button>
                                        <button id="soundToggle"
                                            class="w-full flex items-center justify-between px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <div class="flex items-center space-x-2">
                                                <i data-lucide="volume-2" class="w-4 h-4 text-gray-500"></i>
                                                <span class="text-sm text-gray-700">Sound Alerts</span>
                                            </div>
                                            <div class="relative">
                                                <input type="checkbox" id="soundAlertsToggle" class="sr-only">
                                                <div class="w-10 h-6 bg-gray-200 rounded-full shadow-inner transition-colors duration-300"></div>
                                                <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300"></div>
                                            </div>
                                        </button>
                                    </div>

                                    <!-- Data & Privacy -->
                                    <div class="py-2">
                                        <div class="px-3 py-2">
                                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Data & Privacy</span>
                                        </div>
                                        <button id="dataExport"
                                            class="w-full flex items-center space-x-2 px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <i data-lucide="download" class="w-4 h-4 text-gray-500"></i>
                                            <span class="text-sm text-gray-700">Export Data</span>
                                        </button>
                                        <button id="clearCache"
                                            class="w-full flex items-center space-x-2 px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <i data-lucide="trash-2" class="w-4 h-4 text-gray-500"></i>
                                            <span class="text-sm text-gray-700">Clear Cache</span>
                                        </button>
                                    </div>

                                    <!-- Application Info -->
                                    <div class="py-2 border-t border-gray-100">
                                        <button id="aboutApp"
                                            class="w-full flex items-center space-x-2 px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                            <i data-lucide="info" class="w-4 h-4 text-gray-500"></i>
                                            <span class="text-sm text-gray-700">About</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- User Profile -->
                        <div class="relative">
                            <button id="profileBtn"
                                class="flex items-center space-x-3 p-2 hover:bg-gray-100 rounded-xl transition-all duration-300">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%234f46e5'/%3E%3Ctext x='50' y='58' text-anchor='middle' fill='white' font-size='36' font-family='Arial'%3EU%3C/text%3E%3C/svg%3E"
                                    alt="User Avatar" class="w-8 h-8 rounded-full ring-2 ring-blue-100">
                                <span class="text-sm font-medium text-gray-700 hidden sm:block">{{
                                    session['user_full_name'] or 'User' }}</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500"></i>
                            </button>

                            <!-- Profile Dropdown -->
                            <div id="profileDropdown"
                                class="hidden absolute right-0 mt-2 w-48 bg-white rounded-2xl shadow-xl border border-gray-200 z-50 overflow-hidden">
                                <div class="p-2">
                                    <a href="/profile"
                                        class="flex items-center space-x-2 px-3 py-3 hover:bg-gray-50 rounded-xl transition-colors">
                                        <i data-lucide="user" class="w-4 h-4 text-gray-500"></i>
                                        <span class="text-sm text-gray-700">Profile</span>
                                    </a>
                                    <a href="/"
                                        class="flex items-center space-x-2 px-3 py-3 hover:bg-red-50 rounded-xl text-danger-600 transition-colors">
                                        <i data-lucide="log-out" class="w-4 h-4"></i>
                                        <span class="text-sm">Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main id="dashboardContent"
                class="flex-1 overflow-y-auto bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
                {% block content %}
                <!-- Glass Morphism Loading Overlay -->
                <div id="contentOverlay" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
                    <!-- Background with glass effect -->
                    <div class="absolute inset-0 bg-black/20 backdrop-blur-md"></div>

                    <!-- Content Card -->
                    <div
                        class="relative bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl p-8 w-full max-w-md mx-auto shadow-2xl animate-pulse">
                        <!-- Gradient border effect -->
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-blue-400/20 via-purple-400/20 to-pink-400/20 rounded-3xl blur-sm -z-10">
                        </div>

                        <!-- Loading Spinner -->
                        <div class="flex justify-center mb-6">
                            <div class="relative">
                                <!-- Outer ring -->
                                <div class="w-20 h-20 border-4 border-white/20 rounded-full"></div>
                                <!-- Spinning ring -->
                                <div
                                    class="absolute top-0 left-0 w-20 h-20 border-4 border-transparent border-t-blue-400 border-r-purple-400 rounded-full animate-spin">
                                </div>
                                <!-- Inner glow -->
                                <div
                                    class="absolute top-2 left-2 w-16 h-16 bg-gradient-to-r from-blue-400/20 to-purple-400/20 rounded-full blur-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Content -->
                        <div class="text-center space-y-4">
                            <h3 class="text-2xl font-bold text-white mb-2">
                                Loading Dashboard
                            </h3>
                            <p class="text-white/80 text-lg leading-relaxed">
                                Please wait while we fetch your data...
                            </p>

                            <!-- Progress dots -->
                            <div class="flex justify-center space-x-2 mt-6">
                                <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce"
                                    style="animation-delay: 0s"></div>
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-bounce"
                                    style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce"
                                    style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Dashboard Content -->
                <div class="p-4 md:p-6 lg:p-8 space-y-8">
                    <!-- KPI Cards -->
                    <div id="summaryCards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- OEE Card -->
                        <div id="avgOEECard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-6 metric-card-hover animate-fade-in overflow-hidden relative">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <div class="flex items-center justify-between mb-6 relative z-10">
                                <div class="p-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg">
                                    <i data-lucide="gauge" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="w-16 h-16">
                                        <svg class="progress-ring w-full h-full" viewBox="0 0 42 42">
                                            <circle cx="21" cy="21" r="15.91549430918954" fill="transparent"
                                                stroke="#e5e7eb" stroke-width="3" />
                                            <circle id="oeeProgressCircle" cx="21" cy="21" r="15.91549430918954"
                                                fill="transparent" stroke="#3b82f6" stroke-width="3" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="relative z-10">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">Average OEE</h3>
                                <p id="avgOEEValue" class="text-3xl font-bold text-gray-900 mb-3">--%</p>
                                <div class="flex items-center">
                                    <div class="flex items-center text-success-600">
                                        <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm font-semibold">--%</span>
                                    </div>
                                    <span class="text-xs text-gray-500 ml-2">vs last week</span>
                                </div>
                            </div>
                        </div>

                        <!-- Waste Card -->
                        <div id="totalWasteCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-6 metric-card-hover animate-fade-in overflow-hidden relative"
                            style="animation-delay: 0.1s">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-red-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <div class="flex items-center justify-between mb-6 relative z-10">
                                <div class="p-4 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl shadow-lg">
                                    <i data-lucide="trash-2" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="w-16 h-16">
                                        <svg class="progress-ring w-full h-full" viewBox="0 0 42 42">
                                            <circle cx="21" cy="21" r="15.91549430918954" fill="transparent"
                                                stroke="#e5e7eb" stroke-width="3" />
                                            <circle id="wasteProgressCircle" cx="21" cy="21" r="15.91549430918954"
                                                fill="transparent" stroke="#ef4444" stroke-width="3" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="relative z-10">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">Total Waste</h3>
                                <p id="totalWasteValue" class="text-3xl font-bold text-gray-900 mb-3">-- lbs</p>
                                <div class="flex items-center">
                                    <div class="flex items-center text-success-600">
                                        <i data-lucide="trending-down" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm font-semibold">--%</span>
                                    </div>
                                    <span class="text-xs text-gray-500 ml-2">vs last week</span>
                                </div>
                            </div>
                        </div>

                        <!-- Downtime Card -->
                        <div id="uptimeCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-6 metric-card-hover animate-fade-in overflow-hidden relative"
                            style="animation-delay: 0.2s">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-yellow-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <div class="flex items-center justify-between mb-6 relative z-10">
                                <div class="p-4 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl shadow-lg">
                                    <i data-lucide="clock" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="w-16 h-16">
                                        <svg class="progress-ring w-full h-full" viewBox="0 0 42 42">
                                            <circle cx="21" cy="21" r="15.91549430918954" fill="transparent"
                                                stroke="#e5e7eb" stroke-width="3" />
                                            <circle id="downtimeProgressCircle" cx="21" cy="21" r="15.91549430918954"
                                                fill="transparent" stroke="#f59e0b" stroke-width="3" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="relative z-10">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">Downtime Ratio</h3>
                                <p id="downtimeValue" class="text-3xl font-bold text-gray-900 mb-3">--%</p>
                                <div class="flex items-center">
                                    <div class="flex items-center text-warning-600">
                                        <i data-lucide="minus" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm font-semibold">--%</span>
                                    </div>
                                    <span class="text-xs text-gray-500 ml-2">vs last week</span>
                                </div>
                            </div>
                        </div>

                        <!-- Production Card -->
                        <div id="productionCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-6 metric-card-hover animate-fade-in overflow-hidden relative"
                            style="animation-delay: 0.3s">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-green-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <div class="flex items-center justify-between mb-6 relative z-10">
                                <div class="p-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl shadow-lg">
                                    <i data-lucide="factory" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="w-16 h-16">
                                        <svg class="progress-ring w-full h-full" viewBox="0 0 42 42">
                                            <circle cx="21" cy="21" r="15.91549430918954" fill="transparent"
                                                stroke="#e5e7eb" stroke-width="3" />
                                            <circle id="productionProgressCircle" cx="21" cy="21" r="15.91549430918954"
                                                fill="transparent" stroke="#22c55e" stroke-width="3" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="relative z-10">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">Production Rate</h3>
                                <p id="productionValue" class="text-3xl font-bold text-gray-900 mb-3">--%</p>
                                <div class="flex items-center">
                                    <div class="flex items-center text-success-600">
                                        <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span class="text-sm font-semibold">--%</span>
                                    </div>
                                    <span class="text-xs text-gray-500 ml-2">vs last week</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div id="actionsRow" class="flex flex-wrap gap-4 animate-slide-up">
                        <a id="exportButton" href="/report"
                            class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-2xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold">
                            <i data-lucide="download" class="w-5 h-5 mr-3"></i>
                            Export Report
                        </a>
                        <a id="submitButton" href="/form"
                            class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-2xl hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold">
                            <i data-lucide="plus" class="w-5 h-5 mr-3"></i>
                            Submit Metrics
                        </a>
                        <button id="refreshDataBtn"
                            class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-2xl hover:from-gray-700 hover:to-gray-800 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 font-semibold">
                            <i data-lucide="refresh-cw" class="w-5 h-5 mr-3"></i>
                            <span>Refresh Data</span>
                        </button>
                    </div>

                    <!-- Performance Overview Section -->
                    <div
                        class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-fade-in overflow-hidden relative">
                        <div
                            class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-400/5 to-transparent rounded-full -translate-y-16 translate-x-16">
                        </div>
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8 relative z-10">
                            <div class="mb-4 lg:mb-0">
                                <h2 class="text-2xl font-bold text-gray-900 mb-2">Performance Overview</h2>
                                <p class="text-gray-600">Weekly OEE and Waste performance across both shifts</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div id="timeRangeSelector" class="flex bg-gray-100 rounded-2xl p-2">
                                    <button
                                        class="px-6 py-3 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-sm transition-all duration-300">Current Week</button>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                            <div id="chartOEEWrapper"
                                class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 chart-glow">
                                <canvas id="chartOEE" class="w-full h-80"></canvas>
                            </div>
                            <div id="chartWasteWrapper"
                                class="bg-gradient-to-br from-red-50 to-pink-50 rounded-2xl p-6 chart-glow">
                                <canvas id="chartWaste" class="w-full h-80"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Shift Performance Section -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                        <!-- First Shift -->
                        <div
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-slide-in-left overflow-hidden relative">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-yellow-400/10 to-transparent rounded-full -translate-y-12 translate-x-12">
                            </div>
                            <div class="flex items-center mb-8 relative z-10">
                                <div
                                    class="p-4 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl mr-4 shadow-lg">
                                    <i data-lucide="sun" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">First Shift Performance</h3>
                                    <p class="text-gray-600">Current week operational metrics</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div id="chartOEEFirstShiftWrapper"
                                    class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-4">
                                    <canvas id="chartOEEFirstShift" class="w-full h-60"></canvas>
                                </div>
                                <div id="chartWasteFirstShiftWrapper"
                                    class="bg-gradient-to-br from-red-50 to-pink-50 rounded-xl p-4">
                                    <canvas id="chartWasteFirstShift" class="w-full h-60"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Second Shift -->
                        <div
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-slide-in-right overflow-hidden relative">
                            <div
                                class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-bl from-purple-400/10 to-transparent rounded-full -translate-y-12 translate-x-12">
                            </div>
                            <div class="flex items-center mb-8 relative z-10">
                                <div
                                    class="p-4 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-2xl mr-4 shadow-lg">
                                    <i data-lucide="moon" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">Second Shift Performance</h3>
                                    <p class="text-gray-600">Current week operational metrics</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div id="chartOEESecondShiftWrapper"
                                    class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4">
                                    <canvas id="chartOEESecondShift" class="w-full h-60"></canvas>
                                </div>
                                <div id="chartWasteSecondShiftWrapper"
                                    class="bg-gradient-to-br from-red-50 to-pink-50 rounded-xl p-4">
                                    <canvas id="chartWasteSecondShift" class="w-full h-60"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Analytics Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Recent Activity -->
                        <div id="recentActivityCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-fade-in overflow-hidden relative">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-blue-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <div class="flex items-center justify-between mb-6 relative z-10">
                                <h3 class="text-lg font-bold text-gray-900">Recent Activity</h3>
                                <button
                                    class="text-blue-600 hover:text-blue-700 p-2 hover:bg-blue-50 rounded-xl transition-all duration-300">
                                    <i data-lucide="more-horizontal" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <!-- Dynamic list populated via JS from /api/recent-activities -->
                            <div id="recentActivityList" class="space-y-4 overflow-y-auto max-h-48 relative z-10"></div>
                        </div>

                        <!-- Performance Targets -->
                        <div id="performanceTargetsCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-fade-in overflow-hidden relative"
                            style="animation-delay: 0.1s">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-green-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <h3 class="text-lg font-bold text-gray-900 mb-6 relative z-10">Performance Targets</h3>
                            <div class="space-y-6 relative z-10">
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-sm font-medium text-gray-600">OEE Target</span>
                                        <span id="oeeTargetValue" class="text-sm font-bold text-gray-900">--% /
                                            --%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                        <div id="oeeTargetProgress"
                                            class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out"
                                            style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between mt-2">
                                        <span class="text-xs text-gray-500">Actual vs Target</span>
                                        <span id="oeeTargetStatus" class="text-xs text-gray-500">Loading...</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-sm font-medium text-gray-600">Waste Target</span>
                                        <span id="wasteTargetValue" class="text-sm font-bold text-gray-900">--% /
                                            --%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                                        <div id="wasteTargetProgress"
                                            class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out"
                                            style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between mt-2">
                                        <span class="text-xs text-gray-500">Actual vs Target</span>
                                        <span id="wasteTargetStatus" class="text-xs text-gray-500">Loading...</span>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-sm font-medium text-gray-600">Uptime Target</span>
                                        <span id="uptimeTargetValue" class="text-sm font-bold text-gray-900">--% /
                                            --%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden relative">
                                        <div id="uptimeTargetProgress"
                                            class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out"
                                            style="width: 0%"></div>
                                        <div id="uptimeAchievementBadge" class="target-achievement-badge">✓ Target Met</div>
                                    </div>
                                    <div class="flex justify-between mt-2">
                                        <span class="text-xs text-gray-500">Actual vs Target</span>
                                        <span id="uptimeTargetStatus" class="text-xs text-gray-500">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div id="quickActionsCard"
                            class="bg-white/80 backdrop-blur-xl rounded-3xl shadow-xl border border-white/20 p-8 animate-fade-in overflow-hidden relative"
                            style="animation-delay: 0.2s">
                            <div
                                class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-purple-400/10 to-transparent rounded-full -translate-y-10 translate-x-10">
                            </div>
                            <h3 class="text-lg font-bold text-gray-900 mb-6 relative z-10">Quick Actions</h3>
                            <div class="space-y-4 relative z-10">
                                <a href="/report" id="quickNewReport"
                                    class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 rounded-2xl transition-all duration-300 group cursor-pointer border border-blue-100 hover:border-blue-200">
                                    <div class="flex items-center">
                                        <i data-lucide="file-plus"
                                            class="w-5 h-5 text-blue-600 mr-3 group-hover:scale-110 transition-transform"></i>
                                        <span class="text-sm font-semibold text-gray-900">New Report</span>
                                    </div>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-gray-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all"></i>
                                </a>
                                <a href="/inventory" id="quickInventory"
                                    class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-emerald-50 hover:from-green-100 hover:to-emerald-100 rounded-2xl transition-all duration-300 group cursor-pointer border border-green-100 hover:border-green-200">
                                    <div class="flex items-center">
                                        <i data-lucide="package"
                                            class="w-5 h-5 text-green-600 mr-3 group-hover:scale-110 transition-transform"></i>
                                        <span class="text-sm font-semibold text-gray-900">Inventory</span>
                                    </div>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-gray-400 group-hover:text-green-600 group-hover:translate-x-1 transition-all"></i>
                                </a>
                                <a href="/form?report_type=issue" id="quickIssueReport"
                                    class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 rounded-2xl transition-all duration-300 group cursor-pointer border border-orange-100 hover:border-orange-200">
                                    <div class="flex items-center">
                                        <i data-lucide="alert-triangle"
                                            class="w-5 h-5 text-orange-600 mr-3 group-hover:scale-110 transition-transform"></i>
                                        <span class="text-sm font-semibold text-gray-900">Issue Report</span>
                                    </div>
                                    <i data-lucide="chevron-right"
                                        class="w-4 h-4 text-gray-400 group-hover:text-orange-600 group-hover:translate-x-1 transition-all"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- System Information -->
                    <div id="systemInfoCard"
                        class="bg-gradient-to-br from-slate-900 via-gray-900 to-slate-800 rounded-3xl shadow-2xl p-8 text-white animate-fade-in overflow-hidden relative">
                        <div
                            class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-blue-500/20 to-transparent rounded-full -translate-y-20 translate-x-20">
                        </div>
                        <div
                            class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-purple-500/20 to-transparent rounded-full translate-y-16 -translate-x-16">
                        </div>

                        <div class="mb-8 relative z-10">
                            <h2 class="text-2xl font-bold text-white mb-2">System Status</h2>
                            <p class="text-gray-300">Real-time operational metrics and health indicators</p>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 relative z-10">
                            <div class="glass-dark rounded-2xl p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-300 mb-1">Data Sync</p>
                                        <p id="dataSyncValue" class="text-xl font-bold">--</p>
                                    </div>
                                    <i data-lucide="database" class="w-8 h-8 text-blue-400 floating-icon"></i>
                                </div>
                            </div>
                            <div class="glass-dark rounded-2xl p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-300 mb-1">Uptime</p>
                                        <p id="systemUptimeValue" class="text-xl font-bold">--</p>
                                    </div>
                                    <i data-lucide="server" class="w-8 h-8 text-green-400 floating-icon"></i>
                                </div>
                            </div>
                            <div class="glass-dark rounded-2xl p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p id="recordsTodayLabel" class="text-sm text-gray-300 mb-1">Records Today</p>
                                        <p id="recordsTodayValue" class="text-xl font-bold">--</p>
                                    </div>
                                    <i data-lucide="users" class="w-8 h-8 text-yellow-400 floating-icon"></i>
                                </div>
                            </div>
                            <div class="glass-dark rounded-2xl p-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p id="lastUpdateLabel" class="text-sm text-gray-300 mb-1">Last Update</p>
                                        <p id="lastUpdateValue" class="text-xl font-bold">--</p>
                                    </div>
                                    <i data-lucide="shield-check" class="w-8 h-8 text-purple-400 floating-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endblock %}
                <!-- Footer - Sticky at bottom of main content area -->
                <footer
                    class="sticky bottom-0 bg-white/80 backdrop-blur-xl border-t border-gray-200/50 px-6 py-6 pb-[max(1.5rem,env(safe-area-inset-bottom))]">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="text-sm text-gray-500 mb-2 md:mb-0">
                            © <span id="year"></span> Bakery Metrics App. Created by Gerald Nyah. All rights reserved.
                        </div>
                        <div class="flex items-center space-x-6">
                            <span class="text-xs text-gray-400 font-medium">Version 2.1.0</span>
                            <div class="flex items-center text-xs text-gray-400">
                                <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                                System Status: Healthy
                            </div>
                        </div>
                    </div>
                </footer>

            </main>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel"
        class="fixed top-0 right-0 h-full w-96 bg-white/90 backdrop-blur-xl shadow-2xl transform translate-x-full transition-transform duration-300 z-50 border-l border-gray-200">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
                <button id="closeNotificationPanel" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
        </div>
        <div id="notificationContent" class="p-6 space-y-4 overflow-y-auto max-h-[calc(100vh-120px)]">
            <!-- Dynamic notifications will be loaded here -->
            <div id="notificationLoader" class="flex items-center justify-center py-8">
                <div class="w-8 h-8 border-2 border-blue-200 border-t-blue-500 rounded-full animate-spin"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Set current year
        document.getElementById('year').textContent = new Date().getFullYear();

        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileSidebar = document.getElementById('mobileSidebar');
        const mobileSidebarOverlay = document.getElementById('mobileSidebarOverlay');
        const closeMobileSidebar = document.getElementById('closeMobileSidebar');

        mobileMenuBtn.addEventListener('click', () => {
            mobileSidebar.classList.remove('-translate-x-full');
            mobileSidebarOverlay.classList.remove('hidden');
        });

        const closeMobileSidebarFunction = () => {
            mobileSidebar.classList.add('-translate-x-full');
            mobileSidebarOverlay.classList.add('hidden');
            
            // Also close mobile secondary sidebar when main sidebar closes
            if (isMobileSecondarySidebarOpen && secondarySidebarMobile) {
                secondarySidebarMobile.classList.remove('open');
                managementMenuTriggerMobile.classList.remove('active');
                isMobileSecondarySidebarOpen = false;
            }
        };

        closeMobileSidebar.addEventListener('click', closeMobileSidebarFunction);
        mobileSidebarOverlay.addEventListener('click', closeMobileSidebarFunction);

        // Secondary Sidebar Functionality
        const managementMenuTrigger = document.getElementById('managementMenuTrigger');
        const managementMenuTriggerMobile = document.getElementById('managementMenuTriggerMobile');
        const secondarySidebar = document.getElementById('secondarySidebar');
        const secondarySidebarMobile = document.getElementById('secondarySidebarMobile');
        
        let secondarySidebarTimeout;
        let isSecondarySidebarOpen = false;
        let isMobileSecondarySidebarOpen = false;

        // Desktop Secondary Sidebar - Hover-based interaction
        if (managementMenuTrigger && secondarySidebar) {
            // Show on hover
            managementMenuTrigger.addEventListener('mouseenter', () => {
                clearTimeout(secondarySidebarTimeout);
                secondarySidebar.classList.add('open');
                managementMenuTrigger.classList.add('active');
                isSecondarySidebarOpen = true;
            });

            // Hide when mouse leaves trigger (with delay to allow moving to secondary sidebar)
            managementMenuTrigger.addEventListener('mouseleave', () => {
                secondarySidebarTimeout = setTimeout(() => {
                    if (!secondarySidebar.matches(':hover')) {
                        secondarySidebar.classList.remove('open');
                        managementMenuTrigger.classList.remove('active');
                        isSecondarySidebarOpen = false;
                    }
                }, 300); // Increased delay for better UX
            });

            // Keep secondary sidebar open when hovering over it
            secondarySidebar.addEventListener('mouseenter', () => {
                clearTimeout(secondarySidebarTimeout);
            });

            // Hide when mouse leaves secondary sidebar
            secondarySidebar.addEventListener('mouseleave', () => {
                secondarySidebar.classList.remove('open');
                managementMenuTrigger.classList.remove('active');
                isSecondarySidebarOpen = false;
            });
        }

        // Mobile Secondary Sidebar - Click-based interaction
        if (managementMenuTriggerMobile && secondarySidebarMobile) {
            managementMenuTriggerMobile.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                if (isMobileSecondarySidebarOpen) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                } else {
                    secondarySidebarMobile.classList.add('open');
                    managementMenuTriggerMobile.classList.add('active');
                    isMobileSecondarySidebarOpen = true;
                }
            });

            // Close button for mobile secondary sidebar
            const closeSecondaryMobile = document.getElementById('closeSecondaryMobile');
            if (closeSecondaryMobile) {
                closeSecondaryMobile.addEventListener('click', () => {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                });
            }

            // Enhanced touch and swipe support for mobile
            let touchStartX = 0;
            let touchStartY = 0;
            let isSwiping = false;

            secondarySidebarMobile.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                isSwiping = false;
            }, { passive: true });

            secondarySidebarMobile.addEventListener('touchmove', (e) => {
                if (!isMobileSecondarySidebarOpen) return;
                
                const touchCurrentX = e.touches[0].clientX;
                const touchCurrentY = e.touches[0].clientY;
                const deltaX = touchCurrentX - touchStartX;
                const deltaY = Math.abs(touchCurrentY - touchStartY);
                
                // Only consider horizontal swipes
                if (Math.abs(deltaX) > deltaY && Math.abs(deltaX) > 10) {
                    isSwiping = true;
                    
                    // Swipe left to close (on mobile)
                    if (deltaX < -50 && window.innerWidth < 768) {
                        secondarySidebarMobile.style.transform = `translateX(${Math.max(deltaX, -100)}px)`;
                    }
                }
            }, { passive: true });

            secondarySidebarMobile.addEventListener('touchend', (e) => {
                if (!isMobileSecondarySidebarOpen || !isSwiping) {
                    secondarySidebarMobile.style.transform = '';
                    return;
                }
                
                const touchEndX = e.changedTouches[0].clientX;
                const deltaX = touchEndX - touchStartX;
                
                // Close on significant left swipe (mobile only)
                if (deltaX < -100 && window.innerWidth < 768) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                }
                
                // Reset transform
                secondarySidebarMobile.style.transform = '';
                isSwiping = false;
            }, { passive: true });

            // Close when clicking outside (mobile)
            document.addEventListener('click', (e) => {
                if (isMobileSecondarySidebarOpen && 
                    !managementMenuTriggerMobile.contains(e.target) && 
                    !secondarySidebarMobile.contains(e.target)) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                }
            });

            // Close when main mobile sidebar closes
            mobileSidebarOverlay.addEventListener('click', () => {
                if (isMobileSecondarySidebarOpen) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                }
            });
        }

        // Handle navigation clicks in secondary sidebars
        document.querySelectorAll('.secondary-nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // Close secondary sidebars on navigation
                if (isSecondarySidebarOpen && secondarySidebar) {
                    secondarySidebar.classList.remove('open');
                    managementMenuTrigger.classList.remove('active');
                    isSecondarySidebarOpen = false;
                }
                if (isMobileSecondarySidebarOpen && secondarySidebarMobile) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                }
            });
        });

        // Keyboard support for secondary sidebars
        document.addEventListener('keydown', (e) => {
            // Close secondary sidebar on Escape key
            if (e.key === 'Escape') {
                if (isMobileSecondarySidebarOpen && secondarySidebarMobile) {
                    secondarySidebarMobile.classList.remove('open');
                    managementMenuTriggerMobile.classList.remove('active');
                    isMobileSecondarySidebarOpen = false;
                }
                if (isSecondarySidebarOpen && secondarySidebar) {
                    secondarySidebar.classList.remove('open');
                    managementMenuTrigger.classList.remove('active');
                    isSecondarySidebarOpen = false;
                }
            }
        });

        // Handle window resize for responsive behavior
        window.addEventListener('resize', () => {
            // Close mobile secondary sidebar on desktop resize
            if (window.innerWidth >= 1024 && isMobileSecondarySidebarOpen) {
                secondarySidebarMobile.classList.remove('open');
                managementMenuTriggerMobile.classList.remove('active');
                isMobileSecondarySidebarOpen = false;
            }
            
            // Close desktop secondary sidebar on mobile resize
            if (window.innerWidth < 1024 && isSecondarySidebarOpen) {
                secondarySidebar.classList.remove('open');
                managementMenuTrigger.classList.remove('active');
                isSecondarySidebarOpen = false;
            }
        });

        // Profile and Settings dropdowns - wrapped in DOMContentLoaded to ensure elements exist
        document.addEventListener('DOMContentLoaded', function() {
            // Profile dropdown
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');

            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    profileDropdown.classList.toggle('hidden');
                    // Close settings dropdown if open
                    const settingsDropdown = document.getElementById('settingsDropdown');
                    if (settingsDropdown) {
                        settingsDropdown.classList.add('hidden');
                    }
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                        profileDropdown.classList.add('hidden');
                    }
                });
            }

            // Settings dropdown
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsDropdown = document.getElementById('settingsDropdown');

            if (settingsBtn && settingsDropdown) {
                settingsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    settingsDropdown.classList.toggle('hidden');
                    // Close profile dropdown if open
                    if (profileDropdown) {
                        profileDropdown.classList.add('hidden');
                    }
                });

                // Close settings dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!settingsBtn.contains(e.target) && !settingsDropdown.contains(e.target)) {
                        settingsDropdown.classList.add('hidden');
                    }
                });
            }

            // Settings functionality
            const darkModeToggle = document.getElementById('darkModeToggle');
            const soundAlertsToggle = document.getElementById('soundAlertsToggle');
            const themeToggle = document.getElementById('themeToggle');
            const soundToggle = document.getElementById('soundToggle');

            // Dark mode toggle
            if (themeToggle && darkModeToggle) {
                themeToggle.addEventListener('click', () => {
                    darkModeToggle.checked = !darkModeToggle.checked;
                    toggleDarkMode(darkModeToggle.checked);
                });
            }

            // Sound toggle
            if (soundToggle && soundAlertsToggle) {
                soundToggle.addEventListener('click', () => {
                    soundAlertsToggle.checked = !soundAlertsToggle.checked;
                    toggleSoundAlerts(soundAlertsToggle.checked);
                });
            }

            // Data export functionality
            const dataExportBtn = document.getElementById('dataExport');
            if (dataExportBtn) {
                dataExportBtn.addEventListener('click', () => {
                    exportDashboardData();
                    const settingsDropdown = document.getElementById('settingsDropdown');
                    if (settingsDropdown) {
                        settingsDropdown.classList.add('hidden');
                    }
                });
            }

            // Clear cache functionality
            const clearCacheBtn = document.getElementById('clearCache');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', () => {
                    clearAppCache();
                    const settingsDropdown = document.getElementById('settingsDropdown');
                    if (settingsDropdown) {
                        settingsDropdown.classList.add('hidden');
                    }
                });
            }

            // About app functionality
            const aboutAppBtn = document.getElementById('aboutApp');
            if (aboutAppBtn) {
                aboutAppBtn.addEventListener('click', () => {
                    showAboutModal();
                    const settingsDropdown = document.getElementById('settingsDropdown');
                    if (settingsDropdown) {
                        settingsDropdown.classList.add('hidden');
                    }
                });
            }

            // Notification settings
            const notificationSettingsBtn = document.getElementById('notificationSettings');
            if (notificationSettingsBtn) {
                notificationSettingsBtn.addEventListener('click', () => {
                    showNotificationSettings();
                    const settingsDropdown = document.getElementById('settingsDropdown');
                    if (settingsDropdown) {
                        settingsDropdown.classList.add('hidden');
                    }
                });
            }

            // Load saved settings on page load
            loadUserSettings();

            // Helper function to close all dropdowns
            function closeAllDropdowns() {
                const profileDropdown = document.getElementById('profileDropdown');
                const settingsDropdown = document.getElementById('settingsDropdown');
                
                if (profileDropdown) {
                    profileDropdown.classList.add('hidden');
                }
                if (settingsDropdown) {
                    settingsDropdown.classList.add('hidden');
                }
            }

            // Close dropdowns when pressing Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeAllDropdowns();
                }
            });
        }); // End of DOMContentLoaded

        // Notification panel
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationPanel = document.getElementById('notificationPanel');
        const closeNotificationPanel = document.getElementById('closeNotificationPanel');

        closeNotificationPanel.addEventListener('click', () => {
            notificationPanel.classList.add('translate-x-full');
        });

        // Notification data loading and management
        let notificationRefreshInterval = null;

        // Filter notifications to only include those within the last 24 hours
        function filterRecentNotifications(notifications) {
            if (!Array.isArray(notifications)) return [];

            const now = new Date();
            const twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);

            return notifications.filter(notification => {
                if (!notification.created_at) return false;

                // Parse the notification date
                const notificationDate = new Date(notification.created_at);
                return notificationDate >= twentyFourHoursAgo;
            });
        }

        // Update notification badge count and visibility
        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            const countElement = document.getElementById('notificationCount');

            if (!badge || !countElement) return;

            if (count > 0) {
                badge.classList.remove('hidden');
                countElement.textContent = count > 99 ? '99+' : count.toString();

                // Add animation class for visual feedback
                badge.classList.add('animate-pulse');
                setTimeout(() => {
                    badge.classList.remove('animate-pulse');
                }, 2000);
            } else {
                badge.classList.add('hidden');
            }
        }

        // Load notifications from API
        async function loadNotifications() {
            try {
                const response = await fetch('/api/notifications', {
                    credentials: 'same-origin',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success && data.notifications) {
                    // Filter notifications to only show recent ones (24 hours)
                    const recentNotifications = filterRecentNotifications(data.notifications);

                    // Update badge with count of recent notifications
                    updateNotificationBadge(recentNotifications.length);

                    // Render all notifications in panel (not just recent ones)
                    renderNotifications(data.notifications);
                } else {
                    updateNotificationBadge(0);
                    showNoNotifications();
                }

            } catch (error) {
                console.error('Failed to load notifications:', error);
                updateNotificationBadge(0);
                showNotificationError();
            }
        }

        // Render notifications in the panel
        function renderNotifications(notifications) {
            const container = document.getElementById('notificationContent');

            if (notifications.length === 0) {
                showNoNotifications();
                return;
            }

            // Build notification HTML
            let notificationHtml = '';

            notifications.forEach(notification => {
                const iconInfo = getNotificationIcon(notification.type, notification.success);

                notificationHtml += `
                    <div class="p-4 bg-gradient-to-r ${iconInfo.bgColor} rounded-2xl border ${iconInfo.borderColor} animate-fade-in">
                        <div class="flex items-start space-x-3">
                            <div class="p-2 ${iconInfo.iconBg} rounded-xl">
                                <i data-lucide="${iconInfo.icon}" class="w-4 h-4 ${iconInfo.iconColor}"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-sm font-semibold text-gray-900">${getNotificationTitle(notification.type)}</h4>
                                <p class="text-xs text-gray-600 mt-1">${notification.description}</p>
                                <p class="text-xs text-gray-400 mt-1">${notification.time_ago}</p>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = notificationHtml;

            // Refresh lucide icons for new content
            lucide.createIcons();
        }

        // Get notification icon and styling based on type and success
        function getNotificationIcon(type, success) {
            const iconMap = {
                'form_submission': {
                    icon: success ? 'check-circle' : 'alert-circle',
                    bgColor: success ? 'from-green-50 to-emerald-50' : 'from-red-50 to-pink-50',
                    borderColor: success ? 'border-green-200' : 'border-red-200',
                    iconBg: success ? 'bg-green-100' : 'bg-red-100',
                    iconColor: success ? 'text-green-600' : 'text-red-600'
                },
                'issue_report': {
                    icon: 'alert-triangle',
                    bgColor: 'from-orange-50 to-red-50',
                    borderColor: 'border-orange-200',
                    iconBg: 'bg-orange-100',
                    iconColor: 'text-orange-600'
                },
                'inventory_alert': {
                    icon: 'package',
                    bgColor: 'from-purple-50 to-indigo-50',
                    borderColor: 'border-purple-200',
                    iconBg: 'bg-purple-100',
                    iconColor: 'text-purple-600'
                },
                'kpi_alert': {
                    icon: 'trending-down',
                    bgColor: 'from-red-50 to-pink-50',
                    borderColor: 'border-red-200',
                    iconBg: 'bg-red-100',
                    iconColor: 'text-red-600'
                },
                'week_update': {
                    icon: 'calendar',
                    bgColor: 'from-blue-50 to-indigo-50',
                    borderColor: 'border-blue-200',
                    iconBg: 'bg-blue-100',
                    iconColor: 'text-blue-600'
                }
            };

            return iconMap[type] || iconMap['form_submission'];
        }

        // Get notification title based on type
        function getNotificationTitle(type) {
            const titleMap = {
                'form_submission': 'Form Submission',
                'issue_report': 'Issue Report',
                'inventory_alert': 'Inventory Update',
                'kpi_alert': 'Performance Alert',
                'week_update': 'Week Update'
            };

            return titleMap[type] || 'Notification';
        }

        // Show empty state
        function showNoNotifications() {
            const container = document.getElementById('notificationContent');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12 text-gray-500">
                    <i data-lucide="bell-off" class="w-12 h-12 text-gray-300 mb-4"></i>
                    <h4 class="text-lg font-medium text-gray-600 mb-2">No notifications yet</h4>
                    <p class="text-sm text-gray-400 text-center">
                        New notifications will appear here when there's activity in your bakery operations.
                    </p>
                </div>
            `;
            lucide.createIcons();
        }

        // Show error state
        function showNotificationError() {
            const container = document.getElementById('notificationContent');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12 text-red-500">
                    <i data-lucide="wifi-off" class="w-12 h-12 text-red-300 mb-4"></i>
                    <h4 class="text-lg font-medium text-red-600 mb-2">Failed to load notifications</h4>
                    <p class="text-sm text-red-400 text-center">
                        Please check your connection and try again.
                    </p>
                </div>
            `;
            lucide.createIcons();
        }

        // Enhanced notification panel handlers with data loading
        notificationBtn.addEventListener('click', () => {
            const wasHidden = notificationPanel.classList.contains('translate-x-full');
            notificationPanel.classList.toggle('translate-x-full');

            // Load notifications when panel is opened
            if (wasHidden) {
                loadNotifications();

                // Start auto-refresh when panel is open
                if (notificationRefreshInterval) {
                    clearInterval(notificationRefreshInterval);
                }
                notificationRefreshInterval = setInterval(loadNotifications, 45000); // Refresh every 45 seconds
            } else {
                // Stop auto-refresh when panel is closed
                if (notificationRefreshInterval) {
                    clearInterval(notificationRefreshInterval);
                    notificationRefreshInterval = null;
                }
            }
        });

        closeNotificationPanel.addEventListener('click', () => {
            notificationPanel.classList.add('translate-x-full');

            // Stop auto-refresh when panel is closed
            if (notificationRefreshInterval) {
                clearInterval(notificationRefreshInterval);
                notificationRefreshInterval = null;
            }
        });

        // Load notifications on dashboard initialization (for notification count badge)
        document.addEventListener('DOMContentLoaded', () => {
            // Load notification count for badge without opening panel
            fetch('/api/notifications')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.notifications) {
                        // Filter to get only recent notifications (24 hours)
                        const recentNotifications = filterRecentNotifications(data.notifications);

                        // Update badge with count of recent notifications
                        updateNotificationBadge(recentNotifications.length);
                    } else {
                        updateNotificationBadge(0);
                    }
                })
                .catch(error => {
                    console.log('Notification count check failed:', error);
                    updateNotificationBadge(0);
                });
        });


        // Clock functionality
        function updateClock() {
            const now = new Date();
            let hour = now.getHours();
            const minute = String(now.getMinutes()).padStart(2, '0');
            const second = String(now.getSeconds()).padStart(2, '0');
            const ampm = hour >= 12 ? 'PM' : 'AM';

            hour = hour % 12;
            hour = hour ? hour : 12;

            document.getElementById('hour').textContent = String(hour).padStart(2, '0');
            document.getElementById('minute').textContent = minute;
            document.getElementById('second').textContent = second;
            document.getElementById('ampm').textContent = ampm;

            const options = {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                timeZoneName: 'short'
            };
            const dateStr = now.toLocaleString(undefined, options);
            const tz = dateStr.split(', ').pop();
            document.getElementById('clockDate').textContent = `${now.toLocaleDateString(undefined, {
                weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'
            })} — ${tz}`;
        }

        updateClock();
        setInterval(updateClock, 1000);

        // Update last sync time
        function updateSyncTime() {
            document.getElementById('lastSyncTime').textContent = 'Just now';
        }

        setInterval(updateSyncTime, 30000); // Update every 30 seconds

        // Chart configuration and rendering functions
        let chartOEE, chartWaste, chartOEEFirstShift, chartWasteFirstShift, chartOEESecondShift, chartWasteSecondShift;

        function renderMetricChart({ ctxId, title, data, target, yLabel, bgColor, barColor, lineColor, reverseColorLogic = false }) {
            const values = data.map(Number);
            const colors = values.map(v => {
                if (ctxId.includes('Waste')) {
                    return v <= target ? '#22c55e' : '#ef4444';
                }
                return v >= target ? '#22c55e' : '#ef4444';
            });

            const ctx = document.getElementById(ctxId).getContext('2d');

            // Destroy existing chart
            if (window[ctxId.replace('chart', '').toLowerCase() + 'Chart']) {
                window[ctxId.replace('chart', '').toLowerCase() + 'Chart'].destroy();
            }

            const chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
                    datasets: [
                        {
                            type: 'bar',
                            label: title,
                            data: values,
                            backgroundColor: colors,
                            borderRadius: 8,
                            borderSkipped: false,
                        },
                        {
                            type: 'line',
                            label: 'Performance Trend',
                            data: values,
                            borderColor: lineColor,
                            borderWidth: 3,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#ffffff',
                            pointBorderColor: lineColor,
                            pointBorderWidth: 2,
                        },
                        {
                            type: 'line',
                            label: 'Target',
                            data: Array(5).fill(target),
                            borderColor: '#6366f1',
                            borderDash: [8, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#374151',
                                font: { size: 12, weight: '500' },
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#6366f1',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: false
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'top',
                            color: '#374151',
                            font: { weight: 'bold', size: 11 },
                            formatter: (value, ctx) => {
                                if (ctx.datasetIndex === 0) {
                                    return typeof value === 'number' ? value.toFixed(1) : '';
                                }
                                return '';
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#6b7280',
                                font: { size: 12, weight: '500' }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            suggestedMax: ctxId.includes('OEE') ? 120 : undefined,
                            title: {
                                display: true,
                                text: yLabel,
                                color: '#374151',
                                font: { size: 12, weight: '600' }
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 11 },
                                callback: function (value) {
                                    return value + (yLabel.includes('%') ? '%' : '');
                                }
                            },
                            grid: {
                                color: '#f3f4f6',
                                lineWidth: 1
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Store chart reference
            window[ctxId.replace('chart', '').toLowerCase() + 'Chart'] = chart;
        }

        // Load dashboard data
        async function loadDashboardCharts() {
            try {
                // Load weekly metrics for charts
                const response = await fetch('/api/weekly-metrics?week=latest');
                const result = await response.json();
                console.log('[DEBUG] API Response from /api/weekly-metrics:', result);

                // Update summary cards with real data
                if (result.oeeAvg) {
                    console.log(`[DEBUG] OEE Data: oeeAvg=${result.oeeAvg}`);
                    document.getElementById('avgOEEValue').textContent = result.oeeAvg.toFixed(1) + '%';
                    updateProgressRing('oeeProgressCircle', result.oeeAvg);
                }

                if (result.wasteAvg) {
                    console.log(`[DEBUG] Waste Data: wasteAvg=${result.wasteAvg} (no scaling applied)`);
                    document.getElementById('totalWasteValue').textContent = result.wasteAvg.toFixed(1) + ' lbs';
                    updateProgressRing('wasteProgressCircle', result.wasteAvg); // Use actual database value
                }

                // Update downtime from weekly metrics
                if (result.downtimeRatio !== undefined) {
                    console.log(`[DEBUG] Downtime Data: downtimeRatio=${result.downtimeRatio}`);
                    document.getElementById('downtimeValue').textContent = result.downtimeRatio.toFixed(1) + '%';
                    updateProgressRing('downtimeProgressCircle', result.downtimeRatio);
                }

                // Update production rate from weekly metrics
                if (result.productionRate !== undefined) {
                    console.log(`[DEBUG] Production Data: productionRate=${result.productionRate}`);
                    document.getElementById('productionValue').textContent = result.productionRate.toFixed(1) + '%';
                    updateProgressRing('productionProgressCircle', result.productionRate);
                }

                // Render charts
                renderMetricChart({
                    ctxId: 'chartOEE',
                    title: 'OEE (%)',
                    data: result.oee || [0, 0, 0, 0, 0],
                    target: 70,
                    yLabel: 'OEE (%)',
                    bgColor: '#f8fafc',
                    barColor: '#3b82f6',
                    lineColor: '#f59e0b'
                });

                renderMetricChart({
                    ctxId: 'chartWaste',
                    title: 'Waste (%)',
                    data: result.waste || [0, 0, 0, 0, 0],
                    target: 3.75,
                    yLabel: 'Waste (%)',
                    bgColor: '#f8fafc',
                    barColor: '#ef4444',
                    lineColor: '#f59e0b'
                });

                // First Shift Charts
                renderMetricChart({
                    ctxId: 'chartOEEFirstShift',
                    title: 'OEE (1st Shift)',
                    data: result.oeeFirstShift || [0, 0, 0, 0, 0],
                    target: 70,
                    yLabel: 'OEE (%)',
                    bgColor: '#f8fafc',
                    barColor: '#3b82f6',
                    lineColor: '#f59e0b'
                });

                renderMetricChart({
                    ctxId: 'chartWasteFirstShift',
                    title: 'Waste (1st Shift)',
                    data: result.wasteFirstShift || [0, 0, 0, 0, 0],
                    target: 3.75,
                    yLabel: 'Waste (%)',
                    bgColor: '#f8fafc',
                    barColor: '#ef4444',
                    lineColor: '#f59e0b'
                });

                // Second Shift Charts
                renderMetricChart({
                    ctxId: 'chartOEESecondShift',
                    title: 'OEE (2nd Shift)',
                    data: result.oeeSecondShift || [0, 0, 0, 0, 0],
                    target: 70,
                    yLabel: 'OEE (%)',
                    bgColor: '#f8fafc',
                    barColor: '#22c55e',
                    lineColor: '#f59e0b'
                });

                renderMetricChart({
                    ctxId: 'chartWasteSecondShift',
                    title: 'Waste (2nd Shift)',
                    data: result.wasteSecondShift || [0, 0, 0, 0, 0],
                    target: 3.75,
                    yLabel: 'Waste (%)',
                    bgColor: '#f8fafc',
                    barColor: '#ef4444',
                    lineColor: '#f59e0b'
                });

            } catch (error) {
                console.error('[DEBUG] Failed to load dashboard data:', error);
                // Set default values on error
                document.getElementById('avgOEEValue').textContent = '--';
                document.getElementById('totalWasteValue').textContent = '-- lbs';
                document.getElementById('downtimeValue').textContent = '--';
                document.getElementById('productionValue').textContent = '--';

                // Log the current static ring values for comparison
                console.log('[DEBUG] Static ring values in HTML:');
                console.log('- oeeProgressCircle:', document.getElementById('oeeProgressCircle').getAttribute('stroke-dasharray'));
                console.log('- wasteProgressCircle:', document.getElementById('wasteProgressCircle').getAttribute('stroke-dasharray'));
            }
        }

        // Load dashboard KPIs for trends and additional metrics
        async function loadDashboardKPIs() {
            try {
                const response = await fetch('/api/dashboard-kpis');
                const kpis = await response.json();

                // Update trend indicators with real data
                if (kpis.trends) {
                    // OEE trend
                    if (kpis.trends.oee) {
                        const oeeCard = document.querySelector('#avgOEECard .text-success-600');
                        if (oeeCard) {
                            const trendSpan = oeeCard.querySelector('span');
                            const trendIcon = oeeCard.querySelector('i');
                            if (trendSpan && trendIcon) {
                                const trend = kpis.trends.oee;
                                trendSpan.textContent = `${trend.value > 0 ? '+' : ''}${trend.value}%`;
                                trendIcon.setAttribute('data-lucide', trend.icon);

                                // Update color based on direction
                                if (trend.direction === 'up') {
                                    oeeCard.className = 'flex items-center text-success-600';
                                } else if (trend.direction === 'down') {
                                    oeeCard.className = 'flex items-center text-danger-600';
                                }
                            }
                        }
                    }

                    // Waste trend
                    if (kpis.trends.waste) {
                        const wasteCard = document.querySelector('#totalWasteCard .text-success-600');
                        if (wasteCard) {
                            const trendSpan = wasteCard.querySelector('span');
                            const trendIcon = wasteCard.querySelector('i');
                            if (trendSpan && trendIcon) {
                                const trend = kpis.trends.waste;
                                trendSpan.textContent = `${trend.value > 0 ? '+' : ''}${trend.value}%`;
                                trendIcon.setAttribute('data-lucide', trend.icon);

                                // For waste, down is good (green), up is bad (red)
                                if (trend.direction === 'down') {
                                    wasteCard.className = 'flex items-center text-success-600';
                                } else if (trend.direction === 'up') {
                                    wasteCard.className = 'flex items-center text-danger-600';
                                }
                            }
                        }
                    }

                    // Production trend
                    if (kpis.trends.production) {
                        const productionCard = document.querySelector('#productionCard .text-success-600');
                        if (productionCard) {
                            const trendSpan = productionCard.querySelector('span');
                            const trendIcon = productionCard.querySelector('i');
                            if (trendSpan && trendIcon) {
                                const trend = kpis.trends.production;
                                trendSpan.textContent = `${trend.value > 0 ? '+' : ''}${trend.value}%`;
                                trendIcon.setAttribute('data-lucide', trend.icon);

                                // Update color based on direction
                                if (trend.direction === 'up') {
                                    productionCard.className = 'flex items-center text-success-600';
                                } else if (trend.direction === 'down') {
                                    productionCard.className = 'flex items-center text-danger-600';
                                }
                            }
                        }
                    }

                    // Downtime trend
                    if (kpis.trends.downtime) {
                        const downtimeCard = document.querySelector('#uptimeCard .text-warning-600');
                        if (downtimeCard) {
                            const trendSpan = downtimeCard.querySelector('span');
                            const trendIcon = downtimeCard.querySelector('i');
                            if (trendSpan && trendIcon) {
                                const trend = kpis.trends.downtime;
                                trendSpan.textContent = `${trend.value > 0 ? '+' : ''}${trend.value}%`;
                                trendIcon.setAttribute('data-lucide', trend.icon);

                                // For downtime, down is good (green), up is bad (red)
                                if (trend.direction === 'down') {
                                    downtimeCard.className = 'flex items-center text-success-600';
                                } else if (trend.direction === 'up') {
                                    downtimeCard.className = 'flex items-center text-danger-600';
                                } else {
                                    downtimeCard.className = 'flex items-center text-warning-600';
                                }
                            }
                        }
                    }
                }

                // Refresh lucide icons after updating
                lucide.createIcons();

            } catch (error) {
                console.error('Failed to load dashboard KPIs:', error);
            }
        }

        // Load performance targets from database
        async function loadPerformanceTargets() {
            try {
                const response = await fetch('/api/dashboard-kpis');
                const kpis = await response.json();

                // Check if we have valid data - the API returns KPI data directly, no 'success' field
                // Accept either avgOEE, avgWaste or totalWaste as indicators that KPI data is present.
                if (kpis && (kpis.avgOEE !== undefined || kpis.avgWaste !== undefined || kpis.totalWaste !== undefined)) {
                    // Enhanced target values - check if targets come from database, otherwise use defaults
                    const targets = {
                        oee: { 
                            first: kpis.oeeTarget || 70, 
                            second: kpis.oeeTarget || 70 
                        },
                        waste: { 
                            first: kpis.wasteTarget || 3.75, 
                            second: kpis.wasteTarget || 3.75 
                        },
                        uptime: { 
                            first: kpis.uptimeTarget || 90, 
                            second: kpis.uptimeTarget || 90 
                        }
                    };

                    // Get actual values from KPI data - enhanced uptime calculation
                    // For waste we prefer the average waste percentage directly from the API (kpis.avgWaste).
                    // If it's not provided, fall back to calculating a percentage from totalWaste and totalProduction.
                    const actual = {
                        oee: kpis.avgOEE || 0,
                        waste: (typeof kpis.avgWaste !== 'undefined')
                            ? kpis.avgWaste
                            : ((kpis.totalProduction && kpis.totalProduction > 0)
                                ? (kpis.totalWaste / kpis.totalProduction) * 100
                                : 0),
                        // Enhanced uptime calculation with multiple fallback methods
                        uptime: (() => {
                            // Method 1: Direct availability from database
                            if (typeof kpis.availability !== 'undefined' && kpis.availability !== null) {
                                return Math.max(0, Math.min(100, kpis.availability));
                            }
                            
                            // Method 2: Calculate from downtime ratio
                            if (typeof kpis.downtimeRatio !== 'undefined' && kpis.downtimeRatio !== null) {
                                return Math.max(0, Math.min(100, 100 - kpis.downtimeRatio));
                            }
                            
                            // Method 3: Calculate from actual runtime vs planned time
                            if (kpis.actualRuntime && kpis.plannedProductionTime && kpis.plannedProductionTime > 0) {
                                return Math.max(0, Math.min(100, (kpis.actualRuntime / kpis.plannedProductionTime) * 100));
                            }
                            
                            // Method 4: Calculate from performance if OEE and quality are available
                            if (kpis.avgOEE && kpis.quality && kpis.performance) {
                                // OEE = Availability × Performance × Quality
                                // Therefore: Availability = OEE / (Performance × Quality)
                                const performanceFactor = kpis.performance / 100;
                                const qualityFactor = kpis.quality / 100;
                                if (performanceFactor > 0 && qualityFactor > 0) {
                                    return Math.max(0, Math.min(100, (kpis.avgOEE / (performanceFactor * qualityFactor))));
                                }
                            }
                            
                            // Fallback: Use a default value if no data available
                            console.warn('No uptime data available, using default value');
                            return 0;
                        })()
                    };

                    // Debug logging
                    console.log('Performance Targets Debug:', {
                        kpis: kpis,
                        actual: actual,
                        targets: targets
                    });

                    // Update OEE Target with linear progress behavior (higher OEE = wider bar)
                    document.getElementById('oeeTargetValue').textContent =
                        `${actual.oee.toFixed(1)}% / ${targets.oee.first}%`;

                    // Map OEE values from 0-100% range directly to progress bar width
                    // 0% OEE = 0% width (worst), 100% OEE = 100% width (best)
                    const oeeProgress = Math.max(0, Math.min(100, actual.oee));
                    document.getElementById('oeeTargetProgress').style.width = `${oeeProgress}%`;

                    const oeeStatus = actual.oee >= targets.oee.first ? 'Target Met' :
                        `${(targets.oee.first - actual.oee).toFixed(1)}% to target`;
                    document.getElementById('oeeTargetStatus').textContent = oeeStatus;

                    // Color coding for OEE progress (linear scale based on performance levels)
                    const oeeProgressEl = document.getElementById('oeeTargetProgress');
                    if (actual.oee >= targets.oee.first) {
                        // Green: Exceeds target (>70%) - excellent performance
                        oeeProgressEl.className = 'bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out';
                    } else if (actual.oee >= 40) {
                        // Yellow: Approaching target (40-70%) - good performance
                        oeeProgressEl.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-700 ease-out';
                    } else {
                        // Red: Low OEE (0-40%) - poor performance
                        oeeProgressEl.className = 'bg-gradient-to-r from-red-500 to-red-600 h-3 rounded-full transition-all duration-700 ease-out';
                    }

                    // Update Waste Target with linear progress behavior (higher waste = wider bar)
                    const wastePercentage = actual.waste;
                    document.getElementById('wasteTargetValue').textContent =
                        `${wastePercentage.toFixed(1)}% / ${targets.waste.second}%`;

                    // Map waste values from 1.5-4% range to progress bar width
                    // 1.5% waste = 0% width (best, bar at far left), 4% waste = 100% width (worst, bar fills completely)
                    const minWaste = 1.5; // Minimum waste value (best performance)
                    const maxWaste = 4.0;  // Maximum waste value (worst performance)

                    // Calculate progress: 0% when at minWaste (1.5%), 100% when at maxWaste (4%)
                    const wasteProgress = Math.max(0, Math.min(100,
                        ((wastePercentage - minWaste) / (maxWaste - minWaste)) * 100
                    ));
                    document.getElementById('wasteTargetProgress').style.width = `${wasteProgress}%`;

                    // Precise 1-decimal variance calculation
                    const rawWasteDiff = wastePercentage - targets.waste.second;
                    const wasteDiffRounded = Math.round(rawWasteDiff * 10) / 10;

                    const wasteStatus = rawWasteDiff <= 0
                        ? 'Target Met'
                        : `${wasteDiffRounded.toFixed(1)}% over target`;

                    document.getElementById('wasteTargetStatus').textContent = wasteStatus;

                    // Color coding for Waste progress based on user specifications
                    const wasteProgressEl = document.getElementById('wasteTargetProgress');
                    if (wastePercentage <= 2.5) {
                        // Green: Waste value is low (closer to 2% range)
                        wasteProgressEl.className = 'bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out';
                    } else if (wastePercentage <= targets.waste.second) {
                        // Yellow: Waste value approaches the target (up to 3.75%)
                        wasteProgressEl.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-700 ease-out';
                    } else {
                        // Red: Waste value exceeds the target (>3.75%)
                        wasteProgressEl.className = 'bg-gradient-to-r from-red-500 to-red-600 h-3 rounded-full transition-all duration-700 ease-out';
                    }

                    // Update Uptime Target with enhanced real-time data processing
                    const uptimePercentage = actual.uptime;
                    document.getElementById('uptimeTargetValue').textContent =
                        `${uptimePercentage.toFixed(1)}% / ${targets.uptime.first}%`;

                    // Enhanced progress calculation for better visual representation
                    // Map uptime values from 0-100% range to progress bar width
                    // 0% uptime = 0% width (worst), 100% uptime = 100% width (best)
                    const uptimeProgress = Math.max(0, Math.min(100, uptimePercentage));
                    document.getElementById('uptimeTargetProgress').style.width = `${uptimeProgress}%`;

                    // Enhanced status calculation with precise target comparison
                    const uptimeStatus = uptimePercentage >= targets.uptime.first ? 'Target Met' :
                        `${(targets.uptime.first - uptimePercentage).toFixed(1)}% to target`;
                    document.getElementById('uptimeTargetStatus').textContent = uptimeStatus;

                    // Enhanced color coding for Uptime progress with better thresholds
                    const uptimeProgressEl = document.getElementById('uptimeTargetProgress');
                    const uptimeAchievementBadge = document.getElementById('uptimeAchievementBadge');
                    
                    if (uptimePercentage >= targets.uptime.first) {
                        // Green: Meets or exceeds target (≥90%)
                        uptimeProgressEl.className = 'bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-700 ease-out target-met';
                        if (uptimeAchievementBadge) {
                            uptimeAchievementBadge.classList.add('show');
                        }
                    } else {
                        if (uptimeAchievementBadge) {
                            uptimeAchievementBadge.classList.remove('show');
                        }
                        
                        if (uptimePercentage >= 85) {
                            // Yellow: Good performance, approaching target (85-89%)
                            uptimeProgressEl.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-700 ease-out';
                        } else if (uptimePercentage >= 75) {
                            // Orange: Moderate performance (75-84%)
                            uptimeProgressEl.className = 'bg-gradient-to-r from-orange-500 to-red-500 h-3 rounded-full transition-all duration-700 ease-out';
                        } else {
                            // Red: Poor performance (<75%)
                            uptimeProgressEl.className = 'bg-gradient-to-r from-red-500 to-red-600 h-3 rounded-full transition-all duration-700 ease-out';
                        }
                    }

                    // Add visual indicator animation for better user feedback
                    uptimeProgressEl.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    
                    // Add subtle pulse animation for target met status
                    if (uptimePercentage >= targets.uptime.first) {
                        setTimeout(() => {
                            uptimeProgressEl.style.animation = 'pulse-glow 2s ease-in-out infinite alternate';
                        }, 800); // Delay to allow width transition to complete
                    } else {
                        uptimeProgressEl.style.animation = 'none';
                    }

                    // Add real-time data refresh indicator
                    console.log(`Uptime Target Updated: ${uptimePercentage.toFixed(1)}% (Target: ${targets.uptime.first}%)`);
                    
                    // Trigger a subtle visual feedback to show data has been updated
                    const uptimeContainer = uptimeProgressEl.closest('.space-y-6 > div');
                    if (uptimeContainer) {
                        uptimeContainer.style.transform = 'scale(1.02)';
                        setTimeout(() => {
                            uptimeContainer.style.transform = 'scale(1)';
                        }, 200);
                    }
                } else {
                    console.warn('No valid KPI data received from API');
                }

            } catch (error) {
                console.error('Failed to load performance targets:', error);
                // Keep default values on error
            }
        }

        // Load recent activity data from the server and populate the Recent Activity list.
        // This function fetches the latest activities from the /api/recent-activities endpoint
        // and dynamically constructs list items with a colored dot, description, and relative time.
        async function loadRecentActivities() {
            try {
                const response = await fetch('/api/recent-activities');
                const data = await response.json();
                const listElement = document.getElementById('recentActivityList');
                if (!listElement) {
                    return;
                }
                // Clear any existing items before repopulating
                listElement.innerHTML = '';
                if (data && Array.isArray(data.activities)) {
                    const colorMap = {
                        'metrics': '#10b981',         // green dot for metrics submissions
                        'weekly_report': '#3b82f6',  // blue dot for weekly reports
                        'inventory': '#f59e0b',      // orange dot for inventory transactions
                        'issue': '#ef4444'          // red dot for issues (reserved for future use)
                    };
                    data.activities.forEach(activity => {
                        // Create container for activity item
                        const item = document.createElement('div');
                        item.className = 'flex items-start';

                        // Colored dot indicator
                        const dot = document.createElement('span');
                        dot.className = 'flex-shrink-0 inline-block h-2 w-2 rounded-full mr-3 mt-1';
                        dot.style.backgroundColor = colorMap[activity.type] || '#6b7280'; // default grey

                        // Text wrapper for description and timestamp
                        const textWrapper = document.createElement('div');
                        const description = document.createElement('p');
                        description.className = 'text-sm font-medium text-gray-900';
                        description.textContent = activity.description;
                        const timestamp = document.createElement('p');
                        timestamp.className = 'text-xs text-gray-500';
                        timestamp.textContent = activity.time_ago;
                        textWrapper.appendChild(description);
                        textWrapper.appendChild(timestamp);

                        // Append dot and text to the item container
                        item.appendChild(dot);
                        item.appendChild(textWrapper);

                        // Append the complete activity item to the list
                        listElement.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Failed to load recent activities:', error);
            }
        }

        // Load system information for real-time data with improved error handling and logging
        async function loadSystemInfo() {
            try {
                // Include credentials (cookies) to ensure the session cookie is sent to the backend for authentication.
                // Without credentials, the fetch may be treated as an anonymous request and redirect to the login page,
                // resulting in `--` values. Setting credentials to 'same-origin' sends cookies for same-origin requests.
                const response = await fetch('/api/system-info', {
                    credentials: 'same-origin',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                // Check if response is ok and contains JSON
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const systemInfo = await response.json();
                console.log('System info received:', systemInfo); // Debug logging

                if (systemInfo.success && systemInfo.data) {
                    const data = systemInfo.data;

                    // Update Data Sync status
                    const dataSyncElement = document.getElementById('dataSyncValue');
                    if (dataSyncElement && data.dataSync) {
                        dataSyncElement.textContent = data.dataSync.display;

                        // Update icon color based on health status
                        const dataSyncIcon = dataSyncElement.parentElement.querySelector('i[data-lucide="database"]');
                        if (dataSyncIcon) {
                            if (data.dataSync.healthy) {
                                dataSyncIcon.className = 'w-8 h-8 text-blue-400 floating-icon';
                            } else {
                                dataSyncIcon.className = 'w-8 h-8 text-red-400 floating-icon';
                            }
                        }
                    }

                    // Update System Uptime
                    const uptimeElement = document.getElementById('systemUptimeValue');
                    if (uptimeElement && data.systemUptime) {
                        uptimeElement.textContent = data.systemUptime.display;
                    }

                    // Update Records Today
                    const recordsTodayElement = document.getElementById('recordsTodayValue');
                    const recordsTodayLabel = document.getElementById('recordsTodayLabel');
                    if (recordsTodayElement && data.recordsToday) {
                        recordsTodayElement.textContent = data.recordsToday.display;
                        if (recordsTodayLabel) {
                            recordsTodayLabel.textContent = 'Records Today';
                        }
                    }

                    // Update Last Update time
                    const lastUpdateElement = document.getElementById('lastUpdateValue');
                    const lastUpdateLabel = document.getElementById('lastUpdateLabel');
                    if (lastUpdateElement && data.lastUpdate) {
                        lastUpdateElement.textContent = data.lastUpdate.display;
                        if (lastUpdateLabel) {
                            lastUpdateLabel.textContent = 'Last Update';
                        }
                    }

                    // Update system health indicator if available
                    if (data.systemHealth && data.systemHealth.status) {
                        const healthIcon = document.querySelector('#systemInfoCard i[data-lucide="shield-check"]');
                        if (healthIcon) {
                            switch (data.systemHealth.status) {
                                case 'Healthy':
                                    healthIcon.className = 'w-8 h-8 text-purple-400 floating-icon';
                                    break;
                                case 'Warning':
                                    healthIcon.className = 'w-8 h-8 text-yellow-400 floating-icon';
                                    break;
                                case 'Critical':
                                    healthIcon.className = 'w-8 h-8 text-red-400 floating-icon';
                                    break;
                                default:
                                    healthIcon.className = 'w-8 h-8 text-purple-400 floating-icon';
                            }
                        }
                    }

                    console.log('System info updated successfully'); // Debug logging
                } else {
                    console.warn('Invalid system info response structure:', systemInfo);
                    throw new Error('Invalid response structure');
                }

            } catch (error) {
                console.error('Failed to load system info:', error);

                // Set error indicators on failure
                const elements = [
                    { id: 'dataSyncValue', value: 'Error' },
                    { id: 'systemUptimeValue', value: 'Error' },
                    { id: 'recordsTodayValue', value: 'Error' },
                    { id: 'lastUpdateValue', value: 'Error' }
                ];

                elements.forEach(({ id, value }) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                        element.style.color = '#ef4444'; // Red color for errors
                    }
                });

                // Show error notification
                console.error('System info load failed:', error.message);
            }
        }

        // Update progress ring
        function updateProgressRing(ringId, percentage) {
            console.log(`[DEBUG] updateProgressRing called: ringId=${ringId}, percentage=${percentage}`);
            const circle = document.getElementById(ringId);
            if (circle) {
                const circumference = 2 * Math.PI * 15.91549430918954;
                const offset = circumference - (percentage / 100) * circumference;
                console.log(`[DEBUG] Ring calculations: circumference=${circumference}, offset=${offset}`);
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
                console.log(`[DEBUG] Applied styles to ${ringId}: strokeDasharray=${circle.style.strokeDasharray}, strokeDashoffset=${circle.style.strokeDashoffset}`);
            } else {
                console.error(`[DEBUG] Ring element not found: ${ringId}`);
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async () => {
            const overlay = document.getElementById('contentOverlay');
            overlay.classList.remove('hidden');

            try {
                // Load all dashboard data concurrently
                await Promise.all([
                    loadDashboardCharts(),
                    loadDashboardKPIs(),
                    loadPerformanceTargets(),
                    loadSystemInfo(),
                    loadRecentActivities() // Load recent activities during initial page load
                ]);
            } catch (error) {
                console.error('Dashboard initialization failed:', error);
            }

            // Hide overlay after loading
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, 1500);
        });


        // Refresh all dashboard data
        async function refreshAllDashboardData() {
            try {
                await Promise.all([
                    loadDashboardCharts(),
                    loadDashboardKPIs(),
                    loadPerformanceTargets(),
                    loadSystemInfo(),
                    loadRecentActivities() // Refresh recent activities on interval
                ]);
                console.log('Dashboard data refreshed successfully');
            } catch (error) {
                console.error('Failed to refresh dashboard data:', error);
            }
        }



        // Enhanced Navigation Management
        let isNavigating = false;

        // Enhanced Active navigation state management
        function setActiveNavigation() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-link, .nav-link-mobile, .secondary-nav-link');

            // Remove active class from all links
            navLinks.forEach(link => {
                link.classList.remove('active');
                // Reset loading state
                link.classList.remove('loading');
                const loadingIndicator = link.querySelector('.loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.classList.add('opacity-0');
                }
            });

            // Remove active state from grouped triggers
            const groupedTriggers = document.querySelectorAll('.grouped-nav-trigger');
            groupedTriggers.forEach(trigger => trigger.classList.remove('active'));

            // Map paths to page identifiers
            const pathMap = {
                '/dashboard': 'dashboard',
                '/report': 'report',
                '/form': 'form',
                '/inventory': 'inventory',
                '/inventory-overview': 'inventory-overview',
                '/issues': 'issues',
                '/help': 'help'
            };

            const currentPage = pathMap[currentPath];

            if (currentPage) {
                // Add active class to matching links
                const activeLinks = document.querySelectorAll(`[data-page="${currentPage}"]`);
                activeLinks.forEach(link => link.classList.add('active'));

                // If the active page is in the secondary sidebar, show it and mark trigger as active
                const secondaryPages = ['inventory', 'inventory-overview', 'help'];
                if (secondaryPages.includes(currentPage)) {
                    const managementTrigger = document.getElementById('managementMenuTrigger');
                    const managementTriggerMobile = document.getElementById('managementMenuTriggerMobile');
                    const secondarySidebar = document.getElementById('secondarySidebar');
                    const secondarySidebarMobile = document.getElementById('secondarySidebarMobile');
                    
                    if (managementTrigger) managementTrigger.classList.add('active');
                    if (managementTriggerMobile) managementTriggerMobile.classList.add('active');
                    if (secondarySidebar) secondarySidebar.classList.add('open');
                    if (secondarySidebarMobile) secondarySidebarMobile.classList.add('open');
                }
            }
        }

        // Enhanced navigation with loading states
        function handleNavigation(event) {
            // Allow default behavior but add loading states
            const link = event.currentTarget;
            const href = link.getAttribute('href');
            
            // Don't handle if already navigating or same page
            if (isNavigating || window.location.pathname === href) {
                event.preventDefault();
                return;
            }

            // Set loading state
            isNavigating = true;
            setNavigationLoading(link, true);
            showPageLoadingOverlay();

            // Allow normal navigation to proceed
            // The loading state will be cleared when the new page loads
            setTimeout(() => {
                // Fallback to clear loading state
                if (isNavigating) {
                    isNavigating = false;
                    hidePageLoadingOverlay();
                    setNavigationLoading(link, false);
                }
            }, 5000); // 5 second timeout
        }

        // Set loading state for navigation link
        function setNavigationLoading(link, loading) {
            const loadingIndicator = link.querySelector('.loading-indicator');
            const icon = link.querySelector('i[data-lucide]');
            
            if (loading) {
                link.classList.add('loading');
                if (loadingIndicator) {
                    loadingIndicator.classList.remove('opacity-0');
                }
                if (icon) {
                    icon.style.transform = 'scale(0.9)';
                }
            } else {
                link.classList.remove('loading');
                if (loadingIndicator) {
                    loadingIndicator.classList.add('opacity-0');
                }
                if (icon) {
                    icon.style.transform = '';
                }
            }
        }

        // Page loading overlay management
        function showPageLoadingOverlay() {
            const overlay = document.getElementById('pageLoadingOverlay');
            if (overlay) {
                overlay.classList.add('active');
            }
        }

        function hidePageLoadingOverlay() {
            const overlay = document.getElementById('pageLoadingOverlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        // Enhanced mobile sidebar management
        function setupMobileSidebar() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileSidebar = document.getElementById('mobileSidebar');
            const mobileSidebarOverlay = document.getElementById('mobileSidebarOverlay');
            const closeMobileSidebar = document.getElementById('closeMobileSidebar');

            if (!mobileMenuBtn || !mobileSidebar || !mobileSidebarOverlay || !closeMobileSidebar) {
                return;
            }

            const openMobileSidebar = () => {
                mobileSidebar.classList.remove('-translate-x-full');
                mobileSidebarOverlay.classList.remove('hidden');
                // Add subtle animation delay for nav items
                const navItems = mobileSidebar.querySelectorAll('.nav-link-mobile');
                navItems.forEach((item, index) => {
                    item.style.transitionDelay = `${index * 0.05}s`;
                    item.style.transform = 'translateX(0)';
                });
            };

            const closeMobileSidebarFunction = () => {
                mobileSidebar.classList.add('-translate-x-full');
                mobileSidebarOverlay.classList.add('hidden');
                // Reset nav items
                const navItems = mobileSidebar.querySelectorAll('.nav-link-mobile');
                navItems.forEach((item) => {
                    item.style.transitionDelay = '';
                    item.style.transform = '';
                });
            };

            mobileMenuBtn.addEventListener('click', openMobileSidebar);
            closeMobileSidebar.addEventListener('click', closeMobileSidebarFunction);
            mobileSidebarOverlay.addEventListener('click', closeMobileSidebarFunction);

            // Close mobile sidebar on navigation
            const mobileNavLinks = document.querySelectorAll('#mobileSidebar .nav-link-mobile');
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', () => {
                    setTimeout(closeMobileSidebarFunction, 150);
                });
            });
        }

        // Enhanced tooltip management for better positioning
        function setupTooltips() {
            const tooltipContainers = document.querySelectorAll('.tooltip-container');
            
            tooltipContainers.forEach(container => {
                let tooltipTimeout;
                
                const showTooltip = () => {
                    clearTimeout(tooltipTimeout);
                    tooltipTimeout = setTimeout(() => {
                        // Ensure tooltip is properly positioned and visible
                        const tooltip = container.querySelector('::after');
                        // Additional positioning logic could be added here
                    }, 150);
                };
                
                const hideTooltip = () => {
                    clearTimeout(tooltipTimeout);
                };
                
                container.addEventListener('mouseenter', showTooltip);
                container.addEventListener('mouseleave', hideTooltip);
            });
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Clear loading state from any previous navigation
            isNavigating = false;
            hidePageLoadingOverlay();
            
            // Set up navigation
            setActiveNavigation();
            
            // Add navigation event listeners
            const allNavLinks = document.querySelectorAll('.nav-link, .nav-link-mobile, .secondary-nav-link');
            allNavLinks.forEach(link => {
                link.addEventListener('click', handleNavigation);
            });
            
            // Set up mobile sidebar
            setupMobileSidebar();
            
            // Set up tooltips
            setupTooltips();
        });

        // Handle page visibility change to reset loading states
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Page became visible, clear any loading states
                isNavigating = false;
                hidePageLoadingOverlay();
                const allNavLinks = document.querySelectorAll('.nav-link, .nav-link-mobile');
                allNavLinks.forEach(link => {
                    setNavigationLoading(link, false);
                });
            }
        });

        // Enhanced Quick Overview Management
        function updateQuickOverview() {
            // Update last sync time
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const lastSyncElement = document.getElementById('lastSyncTime');
            const mobileLastSyncElement = document.getElementById('mobileLastSyncTime');
            if (lastSyncElement) {
                lastSyncElement.textContent = timeString;
            }
            if (mobileLastSyncElement) {
                mobileLastSyncElement.textContent = timeString;
            }

            // Simulate active users count (could be replaced with real data)
            const activeUsersElement = document.getElementById('activeUsersCount');
            const mobileActiveUsersElement = document.getElementById('mobileActiveUsersCount');
            if (activeUsersElement) {
                const currentCount = parseInt(activeUsersElement.textContent) || 1;
                const variation = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
                const newCount = Math.max(1, currentCount + variation);
                activeUsersElement.textContent = newCount.toString();
                if (mobileActiveUsersElement) {
                    mobileActiveUsersElement.textContent = newCount.toString();
                }
            }

            // Update performance score with slight variation
            const performanceScoreElement = document.getElementById('performanceScore');
            const performanceBarElement = document.getElementById('performanceBar');
            const mobilePerformanceScoreElement = document.getElementById('mobilePerformanceScore');
            const mobilePerformanceBarElement = document.getElementById('mobilePerformanceBar');
            
            if (performanceScoreElement && performanceBarElement) {
                const currentScore = parseInt(performanceScoreElement.textContent) || 98;
                const variation = Math.floor(Math.random() * 5) - 2; // -2 to 2
                const newScore = Math.max(85, Math.min(100, currentScore + variation));
                
                performanceScoreElement.textContent = `${newScore}%`;
                performanceBarElement.style.width = `${newScore}%`;
                
                // Update mobile elements too
                if (mobilePerformanceScoreElement) {
                    mobilePerformanceScoreElement.textContent = `${newScore}%`;
                }
                if (mobilePerformanceBarElement) {
                    mobilePerformanceBarElement.style.width = `${newScore}%`;
                }
                
                // Update color based on performance
                let barClass;
                if (newScore >= 95) {
                    barClass = 'bg-gradient-to-r from-emerald-400 to-green-500 h-2 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-emerald-400/30';
                } else if (newScore >= 90) {
                    barClass = 'bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-cyan-400/30';
                } else if (newScore >= 80) {
                    barClass = 'bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-yellow-400/30';
                } else {
                    barClass = 'bg-gradient-to-r from-red-400 to-red-500 h-2 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-red-400/30';
                }
                
                performanceBarElement.className = barClass;
                
                // For mobile, adjust height class
                if (mobilePerformanceBarElement) {
                    const mobileBarClass = barClass.replace('h-2', 'h-1.5');
                    mobilePerformanceBarElement.className = mobileBarClass;
                }
            }

            // Add subtle animation to indicate update
            const quickStatsElement = document.getElementById('sidebarQuickStats');
            if (quickStatsElement) {
                quickStatsElement.style.transform = 'scale(1.01)';
                setTimeout(() => {
                    quickStatsElement.style.transform = 'scale(1)';
                }, 200);
            }
        }

        // Initialize Quick Overview animations
        function initializeQuickOverview() {
            // Add staggered animation to overview items
            const overviewItems = document.querySelectorAll('#sidebarQuickStats .space-y-5 > div');
            overviewItems.forEach((item, index) => {
                item.style.animationDelay = `${0.1 + (index * 0.1)}s`;
                item.classList.add('animate-slide-in-left');
            });

            // Initialize performance bar with gradient animation
            const performanceBar = document.getElementById('performanceBar');
            if (performanceBar) {
                performanceBar.style.backgroundSize = '200% 100%';
                performanceBar.style.animation = 'performance-flow 3s ease-in-out infinite';
            }

            // Add hover effects to status indicators
            const statusIndicators = document.querySelectorAll('#sidebarQuickStats .w-2.h-2');
            statusIndicators.forEach(indicator => {
                indicator.addEventListener('mouseenter', () => {
                    indicator.style.transform = 'scale(1.5)';
                    indicator.style.boxShadow = `0 0 15px ${indicator.style.backgroundColor || 'currentColor'}`;
                });
                
                indicator.addEventListener('mouseleave', () => {
                    indicator.style.transform = 'scale(1)';
                    indicator.style.boxShadow = '';
                });
            });
        }

        // Check system health (could integrate with real monitoring)
        function checkSystemHealth() {
            // Simulate system health check
            const dbStatus = document.getElementById('dbStatus');
            const mobileDbStatus = document.getElementById('mobileDbStatus');
            const systemStatusIndicators = document.querySelectorAll('#sidebarQuickStats .animate-pulse');
            
            // Simulate occasional connectivity check
            const isHealthy = Math.random() > 0.05; // 95% uptime simulation
            
            if (dbStatus) {
                if (isHealthy) {
                    dbStatus.textContent = 'Connected';
                    dbStatus.className = 'text-xs font-bold text-green-400';
                    if (mobileDbStatus) {
                        mobileDbStatus.textContent = 'Connected';
                        mobileDbStatus.className = 'text-xs font-bold text-green-400';
                    }
                } else {
                    dbStatus.textContent = 'Checking...';
                    dbStatus.className = 'text-xs font-bold text-yellow-400';
                    if (mobileDbStatus) {
                        mobileDbStatus.textContent = 'Checking...';
                        mobileDbStatus.className = 'text-xs font-bold text-yellow-400';
                    }
                    
                    // Restore after 2 seconds
                    setTimeout(() => {
                        dbStatus.textContent = 'Connected';
                        dbStatus.className = 'text-xs font-bold text-green-400';
                        if (mobileDbStatus) {
                            mobileDbStatus.textContent = 'Connected';
                            mobileDbStatus.className = 'text-xs font-bold text-green-400';
                        }
                    }, 2000);
                }
            }
        }

        // Enhanced refresh function to include Quick Overview
        function refreshQuickOverview() {
            updateQuickOverview();
            checkSystemHealth();
        }

        // Initialize Quick Overview on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuickOverview();
            updateQuickOverview();
            
            // Update Quick Overview every 30 seconds
            setInterval(refreshQuickOverview, 30000);

            // Initialize Refresh Data button after DOM is loaded
            initializeRefreshButton();
        });

        // Initialize Refresh Data button functionality
        function initializeRefreshButton() {
            const refreshBtn = document.getElementById('refreshDataBtn');
            if (!refreshBtn) {
                console.warn('Refresh Data button not found in DOM');
                return;
            }

            refreshBtn.addEventListener('click', async () => {
                const btn = document.getElementById('refreshDataBtn');
                if (!btn) {
                    console.error('Refresh button not found');
                    return;
                }

                const icon = btn.querySelector('i');
                const btnText = btn.querySelector('span');

                // Store original button text
                const originalText = btnText?.textContent?.trim() || 'Refresh Data';

                // Safely disable button and add spinning animation
                btn.disabled = true;
                if (icon) {
                    icon.classList.add('animate-spin');
                }
                
                // Update button text to show refreshing status
                if (btnText) {
                    btnText.textContent = 'Refreshing...';
                }

                try {
                    // Add small delay to ensure loading state is visible
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // Actually refresh all dashboard data
                    await refreshAllDashboardData();

                    // Update last sync time (only if element exists)
                    const lastSyncElement = document.getElementById('lastSyncTime');
                    if (lastSyncElement) {
                        lastSyncElement.textContent = 'Just now';
                    }

                    // Reset button state
                    btn.disabled = false;
                    if (icon) {
                        icon.classList.remove('animate-spin');
                    }
                    
                    // Restore original button text
                    if (btnText) {
                        btnText.textContent = originalText;
                    }

                    // Show enhanced success notification
                    const notification = document.createElement('div');
                    notification.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-2xl shadow-xl z-50 animate-slide-up border border-green-400';
                    notification.innerHTML = `
                        <div class="flex items-center gap-3">
                            <i data-lucide="check-circle" class="w-5 h-5"></i>
                            <div>
                                <div class="font-semibold">Dashboard Refreshed</div>
                                <div class="text-sm text-green-100">All data updated successfully</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(notification);
                    
                    // Safely initialize lucide icons
                    if (typeof lucide !== 'undefined' && lucide.createIcons) {
                        lucide.createIcons();
                    }

                    setTimeout(() => {
                        if (notification && notification.parentNode) {
                            notification.style.transform = 'translateX(100%)';
                            setTimeout(() => {
                                if (notification && notification.parentNode) {
                                    notification.remove();
                                }
                            }, 300);
                        }
                    }, 3000);
                } catch (error) {
                    console.error('Dashboard refresh failed:', error);
                    
                    // Reset button state
                    btn.disabled = false;
                    if (icon) {
                        icon.classList.remove('animate-spin');
                    }
                    
                    // Restore original button text
                    if (btnText) {
                        btnText.textContent = originalText;
                    }

                    // Show enhanced error notification
                    const notification = document.createElement('div');
                    notification.className = 'fixed top-4 right-4 bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-4 rounded-2xl shadow-xl z-50 animate-slide-up border border-red-400';
                    notification.innerHTML = `
                        <div class="flex items-center gap-3">
                            <i data-lucide="alert-circle" class="w-5 h-5"></i>
                            <div>
                                <div class="font-semibold">Refresh Failed</div>
                                <div class="text-sm text-red-100">Please check your connection and try again</div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(notification);
                    
                    // Safely initialize lucide icons
                    if (typeof lucide !== 'undefined' && lucide.createIcons) {
                        lucide.createIcons();
                    }

                    setTimeout(() => {
                        if (notification && notification.parentNode) {
                            notification.style.transform = 'translateX(100%)';
                            setTimeout(() => {
                                if (notification && notification.parentNode) {
                                    notification.remove();
                                }
                            }, 300);
                        }
                    }, 5000);
                }
            });
        }

        // Auto-refresh dashboard every 5 minutes
        setInterval(refreshAllDashboardData, 5 * 60 * 1000);

        // Settings Functions
        function toggleDarkMode(enabled) {
            const body = document.body;
            const toggleDiv = document.querySelector('#themeToggle .w-10');
            const toggleButton = document.querySelector('#themeToggle .absolute');
            
            if (enabled) {
                body.classList.add('dark');
                toggleDiv.classList.remove('bg-gray-200');
                toggleDiv.classList.add('bg-blue-500');
                toggleButton.classList.remove('left-1');
                toggleButton.classList.add('right-1');
            } else {
                body.classList.remove('dark');
                toggleDiv.classList.remove('bg-blue-500');
                toggleDiv.classList.add('bg-gray-200');
                toggleButton.classList.remove('right-1');
                toggleButton.classList.add('left-1');
            }
            
            // Save preference to localStorage
            localStorage.setItem('darkMode', enabled);
            showNotification(enabled ? 'Dark mode enabled' : 'Dark mode disabled', 'success');
        }

        function toggleSoundAlerts(enabled) {
            const toggleDiv = document.querySelector('#soundToggle .w-10');
            const toggleButton = document.querySelector('#soundToggle .absolute');
            
            if (enabled) {
                toggleDiv.classList.remove('bg-gray-200');
                toggleDiv.classList.add('bg-blue-500');
                toggleButton.classList.remove('left-1');
                toggleButton.classList.add('right-1');
            } else {
                toggleDiv.classList.remove('bg-blue-500');
                toggleDiv.classList.add('bg-gray-200');
                toggleButton.classList.remove('right-1');
                toggleButton.classList.add('left-1');
            }
            
            // Save preference to localStorage
            localStorage.setItem('soundAlerts', enabled);
            showNotification(enabled ? 'Sound alerts enabled' : 'Sound alerts disabled', 'success');
        }

        function exportDashboardData() {
            showNotification('Preparing data export...', 'info');
            
            // Simulate data export
            setTimeout(() => {
                const data = {
                    exportDate: new Date().toISOString(),
                    totalUsers: document.getElementById('totalUsers')?.textContent || '0',
                    totalTickets: document.getElementById('totalTickets')?.textContent || '0',
                    systemStatus: 'Active',
                    settings: {
                        darkMode: localStorage.getItem('darkMode') === 'true',
                        soundAlerts: localStorage.getItem('soundAlerts') === 'true'
                    }
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dashboard-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Data exported successfully!', 'success');
            }, 1500);
        }

        function clearAppCache() {
            showNotification('Clearing application cache...', 'info');
            
            // Clear localStorage settings (but keep essential data)
            const essentialKeys = ['user_session', 'auth_token'];
            const currentStorage = {};
            
            essentialKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    currentStorage[key] = localStorage.getItem(key);
                }
            });
            
            localStorage.clear();
            
            // Restore essential data
            Object.keys(currentStorage).forEach(key => {
                localStorage.setItem(key, currentStorage[key]);
            });
            
            // Clear any cached images or temporary data
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        caches.delete(cacheName);
                    });
                });
            }
            
            setTimeout(() => {
                showNotification('Cache cleared successfully!', 'success');
            }, 1000);
        }

        function showAboutModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 relative animate-scale-in">
                    <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <i data-lucide="info" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">Bakery Analytics Dashboard</h3>
                        <p class="text-gray-600 mb-4">Version 1.0.0</p>
                        <p class="text-sm text-gray-500 mb-6">A comprehensive dashboard for managing bakery operations, tracking inventory, and analyzing performance metrics.</p>
                        <div class="flex justify-center space-x-4">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            lucide.createIcons();
        }

        function showNotificationSettings() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-lg mx-4 relative animate-scale-in">
                    <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    <div>
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <i data-lucide="bell-ring" class="w-6 h-6 mr-3 text-blue-600"></i>
                            Notification Preferences
                        </h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <h4 class="font-medium text-gray-900">System Alerts</h4>
                                    <p class="text-sm text-gray-500">Get notified about system issues</p>
                                </div>
                                <input type="checkbox" checked class="rounded">
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <h4 class="font-medium text-gray-900">Inventory Alerts</h4>
                                    <p class="text-sm text-gray-500">Low stock and inventory updates</p>
                                </div>
                                <input type="checkbox" checked class="rounded">
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <h4 class="font-medium text-gray-900">Order Updates</h4>
                                    <p class="text-sm text-gray-500">New orders and status changes</p>
                                </div>
                                <input type="checkbox" class="rounded">
                            </div>
                        </div>
                        <div class="flex justify-end space-x-3 mt-6">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                                Cancel
                            </button>
                            <button onclick="this.closest('.fixed').remove(); showNotification('Notification preferences saved!', 'success')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            lucide.createIcons();
        }

        function loadUserSettings() {
            // Load dark mode preference
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                darkModeToggle.checked = true;
                toggleDarkMode(true);
            }
            
            // Load sound alerts preference
            const soundAlerts = localStorage.getItem('soundAlerts');
            if (soundAlerts === null) {
                // Default to enabled
                soundAlertsToggle.checked = true;
                localStorage.setItem('soundAlerts', 'true');
                toggleSoundAlerts(true);
            } else {
                soundAlertsToggle.checked = soundAlerts === 'true';
                toggleSoundAlerts(soundAlerts === 'true');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            }[type] || 'bg-blue-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Slide in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Slide out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Password Change Enforcement - Client-side fallback
        function checkPasswordChangeRequired() {
            // This is a defense-in-depth measure
            // If somehow user lands on dashboard with password_change_required = true
            fetch('/api/user-status')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.password_change_required) {
                        showPasswordChangeModal();
                    }
                })
                .catch(error => {
                    // Silently fail - server-side enforcement is primary
                    console.log('Status check failed:', error);
                });
        }

        function showPasswordChangeModal() {
            // Create blocking modal
            const modal = document.createElement('div');
            modal.id = 'password-change-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 z-[9999] flex items-center justify-center';
            modal.style.pointerEvents = 'all';
            
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 shadow-2xl">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.962-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Password Change Required</h3>
                        <p class="text-gray-600 mb-6">
                            You must change your password before accessing the dashboard. This is required for your account security.
                        </p>
                        <button onclick="redirectToPasswordChange()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                            Change Password Now
                        </button>
                    </div>
                </div>
            `;
            
            // Disable background interactions
            document.body.style.overflow = 'hidden';
            
            // Add to DOM
            document.body.appendChild(modal);
            
            // Prevent modal from being closed
            modal.addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
            });
        }

        function redirectToPasswordChange() {
            window.location.href = '/set-password';
        }

        // Start password change enforcement checks
        let passwordCheckInterval;
        
        function startPasswordChangeEnforcement() {
            // Check immediately on page load after 5 seconds
            setTimeout(() => {
                checkPasswordChangeRequired();
            }, 5000);
            
            // Then check every 5 seconds
            passwordCheckInterval = setInterval(() => {
                checkPasswordChangeRequired();
            }, 5000);
        }

        // Initialize password change enforcement when page loads
        document.addEventListener('DOMContentLoaded', function() {
            startPasswordChangeEnforcement();
        });

    </script>
</body>

</html>